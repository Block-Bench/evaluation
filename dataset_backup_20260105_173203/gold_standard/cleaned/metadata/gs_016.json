{
  "sample_id": "gs_spearbit_aragon-lock-to-vote_M05",
  "exploit_name": "Using idle balance in computing isGranted doesn't account for frozen & blacklisted tokens",
  "date": "2025-09-11",
  "amount_lost_usd": null,
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "logic_error",
  "vulnerability_subtype": "M-05",
  "severity": "medium",
  "difficulty_tier": 2,
  "is_vulnerable": true,
  "temporal_category": "post_cutoff",
  "description": "In MinVotingPowerCondition.isGranted() at line 45, the function checks 'token.balanceOf(_who) + lockManager.getLockedBalance(_who)'. If an address holds tokens but can't spend them due to being frozen or blacklisted (like USDC/USDT blacklist), they are still granted access to create proposals. The intended behavior should be to not allow calling createProposal as the tokens are not actually transferable.",
  "vulnerable_contract": "MinVotingPowerCondition",
  "vulnerable_function": "isGranted",
  "vulnerable_lines": [],
  "attack_scenario": "1. User holds 1000 USDC but is blacklisted by Circle.\n2. User cannot actually transfer or lock their tokens.\n3. User calls createProposal().\n4. isGranted() at line 45 checks token.balanceOf(user) which returns 1000.\n5. User passes the minProposerVotingPower check despite having unusable tokens.\n6. User can spam create proposals without genuine stake in governance.",
  "root_cause": "In MinVotingPowerCondition.isGranted() at line 45, the function checks 'token.balanceOf(_who) + lockManager.getLockedBalance(_who)'. If an address holds tokens but can't spend them due to being frozen or blacklisted (like USDC/USDT blacklist), they are still granted access to create proposals. The intended behavior should be to not allow calling createProposal as the tokens are not actually transferable.",
  "fix_description": "Do not use token.balanceOf(_who), rather actually require the tokens to be locked in LockManager by making a transfer. Only check lockManager.getLockedBalance(_who) for voting power, removing the token.balanceOf() portion.",
  "source_reference": "https://github.com/spearbit/portfolio/blob/master/pdfs/Aragon-Spearbit-Security-Review-July-2025.pdf",
  "external_references": [
    "https://github.com/aragon/lock-to-vote-plugin/tree/b3c5503c"
  ],
  "tags": [
    "logic_error",
    "spearbit",
    "gold_standard",
    "audit_finding"
  ],
  "variant_type": "cleaned",
  "variant_parent_id": "gs_spearbit_aragon-lock-to-vote_M05",
  "notes": "The isGranted() function at line 45 adds token.balanceOf(_who) to the voting power calculation. For tokens with freeze/blacklist functionality (USDC, USDT, Morpho vault tokens), a user's balance might be frozen but still counted. This allows blacklisted users to participate in governance without transferable stake.",
  "contract_file": "contracts/gs_016.sol",
  "subset": "annotated",
  "original_subset": "gold_standard",
  "transformation": {
    "type": "minimal_sanitization",
    "source": "gold_standard/original",
    "changes": [
      "Removed vulnerability header block (lines 5-40)",
      "Removed 5 '^^^ VULNERABLE LINE ^^^' markers",
      "Removed 1 '@audit-issue' comments"
    ],
    "script": "strategies/sanitize/sanitize_gold_standard.py",
    "created_date": "2026-01-04T14:15:44.584480"
  }
}