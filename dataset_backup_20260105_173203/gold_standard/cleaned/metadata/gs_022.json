{
  "sample_id": "gs_mixbytes_mantle-meth-aave_M01",
  "exploit_name": "Default manager deactivation in LiquidityBuffer can break auto-allocation",
  "date": "2025-10-22",
  "amount_lost_usd": null,
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "logic_error",
  "vulnerability_subtype": "M-1",
  "severity": "medium",
  "difficulty_tier": 2,
  "is_vulnerable": true,
  "temporal_category": "post_cutoff",
  "description": "Staking.allocateETH() forwards ETH to LiquidityBuffer.depositETH(), which auto-allocates to defaultManagerId when shouldExecuteAllocation is true. If the current default manager is deactivated via LiquidityBuffer.updatePositionManager()/togglePositionManagerStatus() without first switching defaultManagerId or disabling auto-allocation, _allocateETHToManager(defaultManagerId, \u2026) reverts with LiquidityBuffer__ManagerInactive(). This can unexpectedly block allocation flows.",
  "vulnerable_contract": "LiquidityBuffer",
  "vulnerable_function": "updatePositionManager",
  "vulnerable_lines": [],
  "attack_scenario": "1. Admin sets defaultManagerId to manager 0 with shouldExecuteAllocation = true\n2. Admin calls togglePositionManagerStatus(0) to deactivate the default manager\n3. User calls Staking.allocateETH() which forwards to LiquidityBuffer.depositETH()\n4. depositETH() calls _allocateETHToManager(defaultManagerId, msg.value)\n5. _allocateETHToManager reverts with LiquidityBuffer__ManagerInactive() because the default manager is inactive\n6. All allocation flows are blocked until admin either reactivates the manager or changes defaultManagerId",
  "root_cause": "Staking.allocateETH() forwards ETH to LiquidityBuffer.depositETH(), which auto-allocates to defaultManagerId when shouldExecuteAllocation is true. If the current default manager is deactivated via LiquidityBuffer.updatePositionManager()/togglePositionManagerStatus() without first switching defaultManagerId or disabling auto-allocation, _allocateETHToManager(defaultManagerId, \u2026) reverts with LiquidityBuffer__ManagerInactive(). This can unexpectedly block allocation flows.",
  "fix_description": "Prevent deactivation of the current defaultManagerId while auto-allocation is enabled: require shouldExecuteAllocation == false or switch defaultManagerId to an active manager before deactivation.",
  "source_reference": "https://github.com/mixbytes/audits_public/tree/master/Mantle%20Network/mETH%20x%20Aave%20Integration",
  "external_references": [
    "https://github.com/mantle-lsp/contracts"
  ],
  "tags": [
    "logic_error",
    "mixbytes",
    "gold_standard",
    "audit_finding"
  ],
  "variant_type": "cleaned",
  "variant_parent_id": "gs_mixbytes_mantle-meth-aave_M01",
  "notes": "The depositETH function auto-allocates to the default manager when shouldExecuteAllocation is true, but updatePositionManager and togglePositionManagerStatus can deactivate the default manager without any check, causing subsequent depositETH calls to revert.",
  "contract_file": "contracts/gs_022.sol",
  "subset": "annotated",
  "original_subset": "gold_standard",
  "transformation": {
    "type": "minimal_sanitization",
    "source": "gold_standard/original",
    "changes": [
      "Removed vulnerability header block (lines 4-36)",
      "Removed 38 '^^^ VULNERABLE LINE ^^^' markers",
      "Removed 4 '@audit-issue' comments"
    ],
    "script": "strategies/sanitize/sanitize_gold_standard.py",
    "created_date": "2026-01-04T14:15:44.589281"
  }
}