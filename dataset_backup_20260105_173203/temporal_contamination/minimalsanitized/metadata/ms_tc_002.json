{
  "sample_id": "ms_tc_002",
  "exploit_name": "Beanstalk",
  "date": "2022-04-17",
  "amount_lost_usd": "182000000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "governance_attack",
  "vulnerability_subtype": "flash_loan_voting",
  "severity": "critical",
  "difficulty_tier": 4,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Beanstalk governance attack using flash loans to gain voting power and execute malicious proposal. Attacker borrowed $1B via flash loan, deposited into Silo to gain majority voting power, proposed and immediately executed a malicious governance action to drain the protocol, then repaid the flash loan.",
  "vulnerable_contract": "BeanstalkGovernance",
  "vulnerable_function": "emergencyCommit",
  "vulnerable_lines": [
    55,
    56,
    101,
    102,
    107
  ],
  "attack_scenario": "Attacker takes massive flash loan from Aave ($1B in stablecoins), swaps for Curve 3pool LP tokens, deposits into Beanstalk Silo gaining >66% voting power, creates malicious governance proposal to transfer all funds, votes with flash-loan-funded power, immediately executes via emergencyCommit(), drains protocol, repays flash loan with profit.",
  "root_cause": "Governance system allowed instant voting power from deposits with no time-weighting or holding period. The emergencyCommit() function enabled immediate execution of proposals that reached 66% approval, with no time delay for community review. This combination made flash loan governance attacks trivial to execute.",
  "fix_description": "Implement time-weighted voting where voting power increases with duration of deposit. Add minimum holding period before deposits grant voting rights. Implement mandatory time delay (timelock) between proposal creation and execution. Remove or heavily restrict emergencyCommit() function. Use snapshot-based voting to prevent same-block deposit and vote. Add multi-sig or guardian oversight for emergency functions.",
  "source_reference": "https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2022-04/Beanstalk_exp.sol",
  "external_references": [
    "https://etherscan.io/tx/0x68cdec0ac76454c3b0f7af0b8a3895db00adf6daaf3b50a99716858c4fa54c6f",
    "https://rekt.news/beanstalk-rekt/"
  ],
  "tags": [
    "governance",
    "flash_loan",
    "voting",
    "timelock",
    "defi",
    "historical",
    "mega_hack"
  ],
  "variant_type": "minimalsanitized",
  "variant_parent_id": "tc_002",
  "notes": "One of the most significant governance attacks in DeFi history. Demonstrated that on-chain governance without time-weighting or timelocks is vulnerable to flash loan manipulation. The attacker used $1B in borrowed capital to completely control the protocol for a single block.",
  "contract_file": "contracts/ms_tc_002.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "minimal_sanitization",
    "source_dir": "dataset/temporal_contamination/original",
    "source_contract": "dataset/temporal_contamination/original/contracts/tc_002.sol",
    "source_metadata": "dataset/temporal_contamination/original/metadata/tc_002.json",
    "script": "strategies/sanitize/minimal_sanitize.py",
    "changes": [
      "Renamed contract: VulnerableBeanstalkGovernance -> BeanstalkGovernance",
      "Removed 4 vulnerability comment block(s)",
      "Removed 2 vulnerability hint line(s)"
    ],
    "contract_renames": {
      "VulnerableBeanstalkGovernance": "BeanstalkGovernance"
    },
    "created_date": "2025-12-29T22:32:44.504306"
  }
}