{
  "id": "hundred_finance_2022_03",
  "exploit_name": "Hundred Finance Reentrancy",
  "date": "2022-03-15",
  "blockchain": "gnosis",
  "amount_lost_usd": "6000000",
  "vulnerability_type": "reentrancy",
  "difficulty": 4,
  "tags": [
    "reentrancy",
    "erc667",
    "compound_fork",
    "token_hooks",
    "gnosis"
  ],
  "description": "Hundred Finance (Compound fork) was exploited via ERC667 token hooks reentrancy. ERC667 tokens call recipient contracts during transfers. The borrow function transferred tokens before fully updating state, allowing attackers to re-enter and borrow multiple times with the same collateral.",
  "attack_scenario": "1) Flash loan ERC667 tokens. 2) Call borrow() to initiate loan. 3) During token transfer, ERC667 hook calls back to attacker contract. 4) Attacker re-enters borrow() before first borrow state update completes. 5) Multiple borrows executed with same collateral. 6) Drained $6M from multiple markets on Gnosis chain.",
  "root_cause": "Compound fork didn't account for ERC667 token hooks that allow reentrancy during transfers. The borrow function violated checks-effects-interactions by transferring tokens before completing state updates, enabling multiple borrows within one transaction.",
  "vulnerable_lines": [43],
  "fix": "Use reentrancy guards (OpenZeppelin ReentrancyGuard). Follow checks-effects-interactions pattern strictly. Update all state before external calls/transfers. Consider blocking ERC667/ERC777 tokens with hooks.",
  "references": [
    "https://twitter.com/HundredFinance/status/1503551732143849477"
  ],
  "temporal_category": "pre_cutoff",
  "variant_type": "original",
  "checks_effects_interactions_violated": true,
  "involves_external_calls": true,
  "vulnerable_contract": {
    "name": "HundredFinanceMarket",
    "functions": [
      {
        "name": "borrow",
        "vulnerability": "Transfers tokens before state updates, vulnerable to ERC667 reentrancy"
      }
    ]
  },
  "contract_file": "contracts/tc_022.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination"
}