{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "traditional_multi_judge_output.schema.json",
  "title": "DS Traditional Tool Multi-Judge Output",
  "description": "Schema for multi-judge evaluation output on traditional tool detection results. Aggregates results from multiple LLM judges using majority voting.",
  "type": "object",
  "required": [
    "sample_id",
    "tool",
    "timestamp",
    "judges",
    "aggregated",
    "agreement",
    "per_judge"
  ],
  "properties": {
    "sample_id": {
      "type": "string",
      "description": "Sample identifier (e.g., ds_t1_001)."
    },
    "tool": {
      "type": "string",
      "enum": ["slither", "mythril"],
      "description": "Traditional tool that was evaluated."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of evaluation."
    },
    "judges": {
      "type": "array",
      "description": "List of judges used in the evaluation.",
      "items": {
        "type": "object",
        "required": ["name", "family"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Judge model name."
          },
          "family": {
            "type": "string",
            "enum": ["anthropic", "openai", "mistral"],
            "description": "Model family."
          }
        }
      }
    },

    "aggregated": {
      "type": "object",
      "description": "Aggregated results from majority voting.",
      "required": [
        "majority_target_found",
        "majority_verdict_correct"
      ],
      "properties": {
        "majority_target_found": {
          "type": "boolean",
          "description": "Majority vote: whether target vulnerability was found."
        },
        "majority_verdict_correct": {
          "type": "boolean",
          "description": "Majority vote: whether tool's verdict was correct."
        },
        "majority_true_positives": {
          "type": "integer",
          "minimum": 0,
          "description": "Median TP count across judges."
        },
        "majority_false_positives": {
          "type": "integer",
          "minimum": 0,
          "description": "Median FP count across judges."
        },
        "majority_precision": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 1,
          "description": "Precision based on majority TP/FP counts."
        }
      }
    },

    "agreement": {
      "type": "object",
      "description": "Inter-judge agreement metrics.",
      "required": [
        "target_found_agreement",
        "verdict_agreement",
        "full_agreement",
        "num_judges"
      ],
      "properties": {
        "target_found_agreement": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Proportion of judges agreeing with majority on target_found."
        },
        "verdict_agreement": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Proportion of judges agreeing with majority on verdict."
        },
        "full_agreement": {
          "type": "boolean",
          "description": "Whether all judges agreed on target_found."
        },
        "num_judges": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of judges used."
        },
        "pairwise_kappa": {
          "type": ["object", "null"],
          "description": "Pairwise Cohen's Kappa between judges (optional).",
          "additionalProperties": {
            "type": "number",
            "minimum": -1,
            "maximum": 1
          }
        }
      }
    },

    "per_judge": {
      "type": "object",
      "description": "Individual results from each judge, keyed by judge name.",
      "additionalProperties": {
        "type": "object",
        "required": [
          "target_vulnerability_found",
          "verdict_correct",
          "true_positives",
          "false_positives"
        ],
        "properties": {
          "target_vulnerability_found": {
            "type": "boolean",
            "description": "Judge's assessment: was target found?"
          },
          "verdict_correct": {
            "type": "boolean",
            "description": "Judge's assessment: was verdict correct?"
          },
          "type_match": {
            "type": "string",
            "enum": ["exact", "semantic", "partial", "wrong", "not_mentioned"],
            "description": "How well the detection matched ground truth type."
          },
          "true_positives": {
            "type": "integer",
            "minimum": 0
          },
          "false_positives": {
            "type": "integer",
            "minimum": 0
          },
          "total_findings": {
            "type": "integer",
            "minimum": 0
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "reasoning": {
            "type": "string",
            "description": "Judge's overall reasoning."
          },
          "latency_ms": {
            "type": "number",
            "minimum": 0
          }
        }
      }
    },

    "ablation": {
      "type": ["object", "null"],
      "description": "Optional ablation study results comparing same-family vs different-family judges.",
      "properties": {
        "same_family_judges": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Judges from detector model families (e.g., haiku, gpt4o-mini)."
        },
        "different_family_judges": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Judges from non-detector families (e.g., codestral)."
        },
        "same_family_target_found": {
          "type": "boolean",
          "description": "Majority vote among same-family judges."
        },
        "different_family_target_found": {
          "type": "boolean",
          "description": "Majority vote among different-family judges."
        },
        "family_bias_detected": {
          "type": "boolean",
          "description": "Whether same-family and different-family judges disagreed."
        }
      }
    }
  },
  "additionalProperties": false
}
