{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "traditional_judge_output.schema.json",
  "title": "DS Traditional Tool Judge Output",
  "description": "Schema for LLM Judge evaluation output on traditional tool (Slither, Mythril) detection results.",
  "type": "object",
  "required": [
    "sample_id",
    "tool",
    "judge_model",
    "timestamp",
    "overall_verdict",
    "findings",
    "target_assessment",
    "summary"
  ],
  "properties": {
    "sample_id": {
      "type": "string",
      "description": "Sample identifier (e.g., ds_t1_001)."
    },
    "tool": {
      "type": "string",
      "enum": ["slither", "mythril"],
      "description": "Traditional tool that was evaluated."
    },
    "judge_model": {
      "type": "string",
      "description": "Model used as judge (e.g., haiku, gpt4o-mini, codestral)."
    },
    "judge_family": {
      "type": "string",
      "enum": ["anthropic", "openai", "mistral"],
      "description": "Model family of the judge."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of evaluation."
    },

    "overall_verdict": {
      "type": "object",
      "description": "Overall assessment of the tool's detection.",
      "required": ["tool_found_issues", "target_detected"],
      "properties": {
        "tool_found_issues": {
          "type": "boolean",
          "description": "Whether the tool reported any findings."
        },
        "target_detected": {
          "type": "boolean",
          "description": "Whether the target vulnerability was detected."
        },
        "verdict_correct": {
          "type": "boolean",
          "description": "Whether the tool's overall verdict (vulnerable/not) was correct."
        }
      }
    },

    "findings": {
      "type": "array",
      "description": "Evaluation of each finding from the tool output.",
      "items": {
        "type": "object",
        "required": [
          "finding_id",
          "tool_check",
          "matches_target",
          "is_valid_concern",
          "classification",
          "reasoning"
        ],
        "properties": {
          "finding_id": {
            "type": "integer",
            "minimum": 0,
            "description": "Index of finding from tool output."
          },
          "tool_check": {
            "type": "string",
            "description": "Tool's check/detector name (e.g., reentrancy-eth, SWC-104)."
          },
          "tool_severity": {
            "type": ["string", "null"],
            "description": "Severity reported by the tool."
          },
          "location": {
            "type": ["string", "null"],
            "description": "Code location (function, line) reported by tool."
          },
          "matches_target": {
            "type": "boolean",
            "description": "Whether this finding matches the target vulnerability."
          },
          "is_valid_concern": {
            "type": "boolean",
            "description": "Whether this is a valid security concern (target or bonus)."
          },
          "classification": {
            "type": "string",
            "enum": [
              "TARGET_MATCH",
              "PARTIAL_MATCH",
              "BONUS_VALID",
              "INVALID",
              "MISCHARACTERIZED",
              "DESIGN_CHOICE",
              "OUT_OF_SCOPE",
              "SECURITY_THEATER",
              "INFORMATIONAL"
            ],
            "description": "Classification of the finding."
          },
          "reasoning": {
            "type": "string",
            "description": "Judge's explanation for the classification."
          }
        }
      }
    },

    "target_assessment": {
      "type": "object",
      "description": "Assessment of target vulnerability detection.",
      "required": ["found", "type_match", "type_match_reasoning"],
      "properties": {
        "found": {
          "type": "boolean",
          "description": "Whether the target vulnerability was found."
        },
        "finding_id": {
          "type": ["integer", "null"],
          "description": "ID of the finding that matched target, null if not found."
        },
        "type_match": {
          "type": "string",
          "enum": ["exact", "semantic", "partial", "wrong", "not_mentioned"],
          "description": "How well the tool's check matched the ground truth vulnerability type."
        },
        "type_match_reasoning": {
          "type": "string",
          "description": "Explanation of type match assessment."
        },
        "location_accuracy": {
          "type": ["string", "null"],
          "enum": ["exact", "close", "wrong", null],
          "description": "Whether the tool pointed to the correct location. Null if target not found."
        }
      }
    },

    "summary": {
      "type": "object",
      "description": "Summary counts of finding classifications for computing precision/recall.",
      "required": ["total_findings"],
      "properties": {
        "total_findings": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of findings reported by tool."
        },
        "target_matches": {
          "type": "integer",
          "minimum": 0,
          "description": "Findings that match the target vulnerability."
        },
        "partial_matches": {
          "type": "integer",
          "minimum": 0,
          "description": "Findings that partially match the target."
        },
        "bonus_valid": {
          "type": "integer",
          "minimum": 0,
          "description": "Valid vulnerabilities found beyond the target."
        },
        "invalid": {
          "type": "integer",
          "minimum": 0,
          "description": "Technically incorrect or non-existent issues."
        },
        "mischaracterized": {
          "type": "integer",
          "minimum": 0,
          "description": "Real issues with wrong type/severity."
        },
        "design_choice": {
          "type": "integer",
          "minimum": 0,
          "description": "Intentional patterns flagged as issues."
        },
        "out_of_scope": {
          "type": "integer",
          "minimum": 0,
          "description": "Issues outside security scope."
        },
        "security_theater": {
          "type": "integer",
          "minimum": 0,
          "description": "Technically true but practically useless findings."
        },
        "informational": {
          "type": "integer",
          "minimum": 0,
          "description": "Informational notes, not vulnerabilities."
        }
      }
    },

    "computed_metrics": {
      "type": "object",
      "description": "Computed precision/recall metrics from the summary.",
      "properties": {
        "true_positives": {
          "type": "integer",
          "minimum": 0,
          "description": "TARGET_MATCH + PARTIAL_MATCH + BONUS_VALID"
        },
        "false_positives": {
          "type": "integer",
          "minimum": 0,
          "description": "INVALID + MISCHARACTERIZED + DESIGN_CHOICE + OUT_OF_SCOPE + SECURITY_THEATER"
        },
        "precision": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 1,
          "description": "TP / (TP + FP), null if no findings."
        }
      }
    },

    "notes": {
      "type": ["string", "null"],
      "description": "Additional observations from the judge."
    },

    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Judge's confidence in the evaluation."
    },

    "judge_latency_ms": {
      "type": "number",
      "minimum": 0,
      "description": "Judge evaluation latency in milliseconds."
    },
    "judge_input_tokens": {
      "type": "integer",
      "minimum": 0,
      "description": "Input tokens used for judge call."
    },
    "judge_output_tokens": {
      "type": "integer",
      "minimum": 0,
      "description": "Output tokens from judge call."
    }
  },
  "additionalProperties": false
}
