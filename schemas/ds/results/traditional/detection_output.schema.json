{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "traditional_detection_output.schema.json",
  "title": "DS Traditional Tool Detection Output",
  "description": "Schema for traditional tool (Slither, Mythril) detection output on DS samples.",
  "type": "object",
  "required": [
    "sample_id",
    "tier",
    "tool",
    "tool_version",
    "solc_version",
    "timestamp",
    "success",
    "execution_time_ms",
    "exit_code",
    "raw_output"
  ],
  "properties": {
    "sample_id": {
      "type": "string",
      "description": "Sample identifier (e.g., ds_t1_001).",
      "pattern": "^ds_t[0-9]+_[0-9]+$"
    },
    "tier": {
      "type": "string",
      "description": "Tier of the sample.",
      "enum": ["tier1", "tier2", "tier3", "tier4"]
    },
    "tool": {
      "type": "string",
      "description": "Name of the analysis tool.",
      "enum": ["slither", "mythril"]
    },
    "tool_version": {
      "type": "string",
      "description": "Version of the tool used."
    },
    "solc_version": {
      "type": "string",
      "description": "Solidity compiler version used for analysis."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the analysis."
    },
    "success": {
      "type": "boolean",
      "description": "Whether the analysis completed successfully."
    },
    "error": {
      "type": ["string", "null"],
      "description": "Error message if analysis failed."
    },
    "execution_time_ms": {
      "type": "number",
      "minimum": 0,
      "description": "Analysis execution time in milliseconds."
    },
    "exit_code": {
      "type": "integer",
      "description": "Exit code from the tool (-1 for timeout)."
    },
    "used_reduced_depth": {
      "type": "boolean",
      "description": "Whether Mythril used -t 1 (reduced transaction depth) due to timeout."
    },
    "raw_output": {
      "type": "object",
      "description": "Raw output from the tool.",
      "oneOf": [
        { "$ref": "#/definitions/slither_output" },
        { "$ref": "#/definitions/mythril_output" },
        { "$ref": "#/definitions/empty_output" }
      ]
    }
  },
  "definitions": {
    "slither_output": {
      "type": "object",
      "description": "Slither JSON output structure.",
      "properties": {
        "success": { "type": "boolean" },
        "error": { "type": ["string", "null"] },
        "results": {
          "type": "object",
          "properties": {
            "detectors": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["check", "impact", "confidence", "description"],
                "properties": {
                  "check": {
                    "type": "string",
                    "description": "Detector/check name (e.g., reentrancy-eth, unchecked-send)."
                  },
                  "impact": {
                    "type": "string",
                    "enum": ["High", "Medium", "Low", "Informational", "Optimization"],
                    "description": "Severity/impact level."
                  },
                  "confidence": {
                    "type": "string",
                    "enum": ["High", "Medium", "Low"],
                    "description": "Confidence level of the finding."
                  },
                  "description": {
                    "type": "string",
                    "description": "Human-readable description of the finding."
                  },
                  "elements": {
                    "type": "array",
                    "description": "Code elements involved in the finding.",
                    "items": {
                      "type": "object",
                      "properties": {
                        "type": { "type": "string" },
                        "name": { "type": "string" },
                        "source_mapping": {
                          "type": "object",
                          "properties": {
                            "start": { "type": "integer" },
                            "length": { "type": "integer" },
                            "lines": { "type": "array", "items": { "type": "integer" } }
                          }
                        }
                      }
                    }
                  },
                  "id": { "type": "string" },
                  "markdown": { "type": "string" },
                  "first_markdown_element": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },
    "mythril_output": {
      "type": "object",
      "description": "Mythril JSON output structure.",
      "properties": {
        "success": { "type": "boolean" },
        "error": { "type": ["string", "null"] },
        "issues": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["title", "severity", "description"],
            "properties": {
              "title": {
                "type": "string",
                "description": "Issue title (e.g., Unchecked return value)."
              },
              "swc-id": {
                "type": "string",
                "description": "SWC Registry ID for the issue type."
              },
              "severity": {
                "type": "string",
                "enum": ["High", "Medium", "Low"],
                "description": "Severity level."
              },
              "description": {
                "type": "string",
                "description": "Detailed description of the issue."
              },
              "contract": {
                "type": "string",
                "description": "Contract name where issue was found."
              },
              "function": {
                "type": "string",
                "description": "Function name where issue was found."
              },
              "lineno": {
                "type": "integer",
                "description": "Line number in source code."
              },
              "code": {
                "type": "string",
                "description": "Code snippet related to the issue."
              },
              "filename": {
                "type": "string",
                "description": "Source file path."
              },
              "address": {
                "type": "integer",
                "description": "Bytecode address of the issue."
              },
              "sourceMap": {
                "type": "string",
                "description": "Source map location."
              },
              "min_gas_used": { "type": "integer" },
              "max_gas_used": { "type": "integer" },
              "tx_sequence": {
                "type": "object",
                "description": "Transaction sequence to trigger the issue."
              }
            }
          }
        }
      }
    },
    "empty_output": {
      "type": "object",
      "description": "Empty output for failed analyses.",
      "properties": {
        "error": { "type": "string" },
        "raw": { "type": "string" }
      }
    }
  },
  "additionalProperties": false
}
