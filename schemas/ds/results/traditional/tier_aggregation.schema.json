{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "traditional_tier_aggregation.schema.json",
  "title": "DS Traditional Tool Tier Aggregation",
  "description": "Schema for aggregated metrics across a tier for traditional tool evaluations.",
  "type": "object",
  "required": [
    "tool",
    "tier",
    "timestamp",
    "sample_counts",
    "detection_metrics",
    "judge_agreement"
  ],
  "properties": {
    "tool": {
      "type": "string",
      "enum": ["slither", "mythril"],
      "description": "Traditional tool being aggregated."
    },
    "tier": {
      "type": "string",
      "enum": ["tier1", "tier2", "tier3", "tier4"],
      "description": "Tier being aggregated."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp of aggregation."
    },
    "judges_used": {
      "type": "array",
      "items": { "type": "string" },
      "description": "List of judge models used."
    },

    "sample_counts": {
      "type": "object",
      "description": "Counts of samples in different states.",
      "required": ["total", "successful_analyses", "failed_analyses"],
      "properties": {
        "total": {
          "type": "integer",
          "minimum": 0,
          "description": "Total samples in the tier."
        },
        "successful_analyses": {
          "type": "integer",
          "minimum": 0,
          "description": "Samples where tool completed successfully."
        },
        "failed_analyses": {
          "type": "integer",
          "minimum": 0,
          "description": "Samples where tool failed (timeout, compilation error, etc.)."
        },
        "timeout_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Samples that timed out."
        },
        "evaluated": {
          "type": "integer",
          "minimum": 0,
          "description": "Samples that were evaluated by judges."
        }
      }
    },

    "detection_metrics": {
      "type": "object",
      "description": "Detection performance metrics (majority vote from judges).",
      "required": [
        "target_found_count",
        "target_found_rate",
        "verdict_accuracy"
      ],
      "properties": {
        "target_found_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of samples where target vulnerability was found."
        },
        "target_found_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Proportion of successful analyses where target was found."
        },
        "verdict_accuracy": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Proportion of correct verdicts (vulnerable/not)."
        },
        "avg_true_positives": {
          "type": "number",
          "minimum": 0,
          "description": "Average TP per sample."
        },
        "avg_false_positives": {
          "type": "number",
          "minimum": 0,
          "description": "Average FP per sample."
        },
        "avg_precision": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 1,
          "description": "Average precision across samples."
        },
        "avg_findings_per_sample": {
          "type": "number",
          "minimum": 0,
          "description": "Average number of findings per sample."
        }
      }
    },

    "judge_agreement": {
      "type": "object",
      "description": "Inter-judge agreement statistics.",
      "properties": {
        "avg_target_found_agreement": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Average agreement on target_found across samples."
        },
        "avg_verdict_agreement": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Average agreement on verdict across samples."
        },
        "full_agreement_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Proportion of samples with full judge agreement."
        },
        "disagreement_samples": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Sample IDs where judges disagreed."
        }
      }
    },

    "by_vulnerability_type": {
      "type": "object",
      "description": "Breakdown of metrics by ground truth vulnerability type.",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "total_samples": { "type": "integer", "minimum": 0 },
          "successful_analyses": { "type": "integer", "minimum": 0 },
          "target_found_count": { "type": "integer", "minimum": 0 },
          "target_found_rate": { "type": "number", "minimum": 0, "maximum": 1 }
        }
      }
    },

    "by_type_match": {
      "type": "object",
      "description": "Breakdown by type match quality.",
      "properties": {
        "exact": { "type": "integer", "minimum": 0 },
        "semantic": { "type": "integer", "minimum": 0 },
        "partial": { "type": "integer", "minimum": 0 },
        "wrong": { "type": "integer", "minimum": 0 },
        "not_mentioned": { "type": "integer", "minimum": 0 }
      }
    },

    "ablation_results": {
      "type": ["object", "null"],
      "description": "Optional ablation study comparing same-family vs different-family judges.",
      "properties": {
        "same_family_target_found_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "different_family_target_found_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "agreement_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "How often same-family and different-family majorities agree."
        },
        "bias_indicator": {
          "type": "string",
          "enum": ["none", "slight", "moderate", "significant"],
          "description": "Indication of family bias level."
        }
      }
    }
  },
  "additionalProperties": false
}
