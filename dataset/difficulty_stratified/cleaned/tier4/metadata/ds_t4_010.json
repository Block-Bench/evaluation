{
  "id": "ds_t4_010",
  "original_id": "defivulnlabs_readonlyreentrancy",
  "source_dataset": "DeFiVulnLabs",
  "language": "solidity",
  "chain": "evm",
  "file_name": "ReadOnlyReentrancy.sol",
  "vulnerable_function": "multiple",
  "vulnerable_lines": [],
  "vulnerability_type": "reentrancy",
  "original_category": null,
  "severity": "critical",
  "difficulty_tier": 4,
  "description": "The Read-Only Reentrancy issue is a flaw in smart contract design that allows the 'read-only' nature of a function to be used to make unintended changes to the contract's state. Specifically, the issue arises when the remove_liquidity function of the ICurve contract triggers the receive function in an operator contract. This is achieved by an external call from a secure smart contract 'A' invoking the fallback() function in the operator's contract. Through this, code can be executed within the fallback() function against a target contract 'B,' which is indirectly related to contract 'A.' Contract 'B' derives the price of the LP token from Contract 'A,' making it susceptible to manipulation and unintended price changes through the reentrancy callback.",
  "fix_description": "Avoid any state-changing operations within functions that are intended to be read-only.\nMakerdao example:\n        // This will revert if called during execution of a state-modifying pool function.\n        if (nonreentrant) {\n            uint256[2] calldata amounts;\n            CurvePoolLike(pool).remove_liquidity(0, amounts);\n        }",
  "is_vulnerable": true,
  "context_level": "intra_contract",
  "original_source_path": "src/test/ReadOnlyReentrancy.sol",
  "source_url": null,
  "references": [
    "https://twitter.com/1nf0s3cpt/status/1590622114834706432"
  ],
  "framework": "foundry",
  "contract_file": "contracts/ds_t4_010.sol",
  "subset": "cleaned",
  "original_subset": "difficulty_stratified",
  "original_ds_id": "ds_231",
  "sanitized_from": "ds_231",
  "sanitized_id": "sn_ds_231",
  "identifier_mappings": {
    "VulnContract": "CoreContract",
    "ExploitContract": "OperatorContract",
    "ExploitTest": "OperatorTest",
    "hack": "execute",
    "testPwn": "testExecution",
    "performReadOnlyReentrnacy": "performReadOnlyCallback"
  },
  "vulnerable_functions": [
    "getReward"
  ]
}
