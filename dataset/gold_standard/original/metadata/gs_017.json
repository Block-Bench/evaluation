{
  "sample_id": "gs_spearbit_aragon-lock-to-vote_M06",
  "exploit_name": "currentTokenSupply() can be gamed risk-free to manipulate either side of votes in certain assets",
  "date": "2025-09-11",
  "amount_lost_usd": null,
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "logic_error",
  "vulnerability_subtype": "M-06",
  "severity": "medium",
  "difficulty_tier": 3,
  "is_vulnerable": true,
  "temporal_category": "post_cutoff",
  "description": "The currentTokenSupply() function at LockToVotePlugin line 249-251 returns IERC20(lockManager.token()).totalSupply(). This is used in threshold checks (isMinVotingPowerReached, isMinApprovalReached). For tokens like ERC4626 shares, flash-mintable tokens (DAI, WETH), or tokens with permissionless minting, attackers can manipulate totalSupply to skew voting thresholds. This is especially impactful during the last block of a proposal.",
  "vulnerable_contract": "LockToVotePlugin",
  "vulnerable_function": "currentTokenSupply",
  "vulnerable_lines": [
    291,
    292,
    293
  ],
  "attack_scenario": "1. A proposal is close to passing based on participation threshold.\n2. Attacker flash-mints large amount of tokens (e.g., via ERC4626 vault deposit).\n3. currentTokenSupply() returns inflated totalSupply.\n4. isMinVotingPowerReached() calculates: votes / inflatedSupply.\n5. Participation ratio appears lower than required.\n6. Proposal that should pass now fails.\n7. Attacker burns/withdraws the tokens in same transaction.",
  "root_cause": "The currentTokenSupply() function at LockToVotePlugin line 249-251 returns IERC20(lockManager.token()).totalSupply(). This is used in threshold checks (isMinVotingPowerReached, isMinApprovalReached). For tokens like ERC4626 shares, flash-mintable tokens (DAI, WETH), or tokens with permissionless minting, attackers can manipulate totalSupply to skew voting thresholds. This is especially impactful during the last block of a proposal.",
  "fix_description": "Avoid using currentTotalSupply where it can be skewed. Consider recording totalSupply at proposal creation time. Document token compatibility requirements. Use conservative figures if supply changes significantly.",
  "source_reference": "https://github.com/spearbit/portfolio/blob/master/pdfs/Aragon-Spearbit-Security-Review-July-2025.pdf",
  "external_references": [
    "https://github.com/aragon/lock-to-vote-plugin/tree/b3c5503c"
  ],
  "tags": [
    "logic_error",
    "spearbit",
    "gold_standard",
    "audit_finding"
  ],
  "variant_type": "original",
  "variant_parent_id": null,
  "notes": "The currentTokenSupply() at lines 249-251 returns IERC20.totalSupply() directly. For tokens where supply can be atomically manipulated (flash-mintable, ERC4626 shares), attackers can inflate/deflate supply during threshold calculations. This allows gaming the participation and approval requirements, especially on the last block of voting.",
  "contract_file": "contracts/gs_017.sol",
  "subset": "annotated",
  "original_subset": "gold_standard"
}