schema_version: "1.0"
sample_id: "ms_tc_005"
vulnerability_type: "access_control"
vulnerable_lines: [91]

# Full line coverage for scoring. UNRELATED items are batched for efficiency.
# Detailed rationales only for security-relevant code acts.

code_acts:

  # ============================================
  # SECURITY-RELEVANT CODE ACTS (detailed)
  # ============================================

  # --- EthCrossChainData contract (not vulnerable, but relevant) ---

  - id: "CA1"
    type: "DECLARATION"
    lines: [15, 16]
    code: |
      address public owner;
      bytes public currentEpochPublicKeys;
    security_function: "BENIGN"
    rationale: "State variable declarations for owner and validator public keys."

  - id: "CA2"
    type: "INITIALIZATION"
    lines: [24, 25, 26]
    code: "constructor() { owner = msg.sender; }"
    security_function: "BENIGN"
    rationale: "Constructor sets initial owner. Correctly implemented."

  - id: "CA3"
    type: "ACCESS_CTRL"
    lines: [28, 29, 30, 31]
    code: |
      modifier onlyOwner() {
          require(msg.sender == owner, "Not owner");
          _;
      }
    security_function: "BENIGN"
    rationale: "Correctly implemented access control modifier. This is architectural context - the modifier works as designed. The vulnerability is in EthCrossChainManager's unrestricted execution, not in this guard."

  - id: "CA4"
    type: "STATE_MOD"
    lines: [33, 34, 35, 36, 37, 38, 39]
    code: "function putCurEpochConPubKeyBytes(...) external onlyOwner"
    security_function: "BENIGN"
    rationale: "Function correctly protected by onlyOwner. This is the attack target (what gets exploited), not a prerequisite. The function itself is correctly implemented."

  - id: "CA5"
    type: "STATE_MOD"
    lines: [41, 42, 43, 44, 45]
    code: "function transferOwnership(address newOwner) external onlyOwner"
    security_function: "BENIGN"
    rationale: "Ownership transfer function. Correctly protected by onlyOwner."

  - id: "CA6"
    type: "CTRL_FLOW"
    lines: [47, 48, 49]
    code: "function getCurEpochConPubKeyBytes() external view"
    security_function: "BENIGN"
    rationale: "View function returning public keys. No state modification."

  # --- EthCrossChainManager contract (vulnerable) ---

  - id: "CA7"
    type: "DECLARATION"
    lines: [53]
    code: "address public dataContract;"
    security_function: "BENIGN"
    rationale: "Storage declaration for EthCrossChainData address. This is architectural context - the vulnerability is in the unrestricted call (CA12), not in where the address is stored."

  - id: "CA8"
    type: "INITIALIZATION"
    lines: [61, 62, 63]
    code: "constructor(address _dataContract) { dataContract = _dataContract; }"
    security_function: "BENIGN"
    rationale: "Constructor initialization. Correctly implemented."

  - id: "CA9"
    type: "INPUT_VAL"
    lines: [74]
    code: 'require(_verifyHeader(rawHeader, headerSig), "Invalid header");'
    security_function: "BENIGN"
    rationale: "Header verification check. Correctly validates cross-chain transaction headers."

  - id: "CA10"
    type: "INPUT_VAL"
    lines: [78]
    code: 'require(_verifyProof(proof, rawHeader), "Invalid proof");'
    security_function: "BENIGN"
    rationale: "Merkle proof verification. Correctly validates transaction inclusion."

  - id: "CA11"
    type: "COMPUTATION"
    lines: [81, 82, 83, 84, 85]
    code: "(address toContract, bytes memory method, bytes memory args) = _decodeTx(proof);"
    security_function: "BENIGN"
    rationale: "Function call to decode transaction. The call itself is correct - the issue is in _decodeTx (CA17) returning an unvalidated target."

  - id: "CA12"
    type: "EXT_CALL"
    lines: [91]
    code: "(bool success, ) = toContract.call(abi.encodePacked(method, args));"
    security_function: "ROOT_CAUSE"
    rationale: "ROOT_CAUSE - Unrestricted external call to ANY contract decoded from cross-chain transaction. No validation that toContract is not a privileged system contract like EthCrossChainData. Attacker can target EthCrossChainData, which trusts EthCrossChainManager as owner, bypassing access control."

  - id: "CA13"
    type: "INPUT_VAL"
    lines: [92]
    code: 'require(success, "Execution failed");'
    security_function: "BENIGN"
    rationale: "Checks execution success. Correctly implemented."

  - id: "CA14"
    type: "CTRL_FLOW"
    lines: [94]
    code: "return true;"
    security_function: "BENIGN"
    rationale: "Return statement."

  - id: "CA15"
    type: "COMPUTATION"
    lines: [100, 101, 102, 103, 105]
    code: "function _verifyHeader(...) internal pure returns (bool)"
    security_function: "BENIGN"
    rationale: "Header verification (simplified). In reality validates validator signatures."

  - id: "CA16"
    type: "COMPUTATION"
    lines: [111, 112, 113, 114, 116]
    code: "function _verifyProof(...) internal pure returns (bool)"
    security_function: "BENIGN"
    rationale: "Merkle proof verification (simplified). Correctly validates proof."

  - id: "CA17"
    type: "COMPUTATION"
    lines: [122, 123, 124, 125, 126, 127, 128, 133, 134, 135, 136, 137, 138]
    code: "function _decodeTx(...) internal view returns (...)"
    security_function: "BENIGN"
    rationale: "Decodes target contract from cross-chain proof. This is mechanical data extraction - the vulnerability is the lack of validation before calling the decoded target (CA12), not the decoding itself."

  # ============================================
  # UNRELATED CODE ACTS (batched)
  # ============================================

  - id: "CA_DIRECTIVES"
    type: "DIRECTIVE"
    lines: [1, 2]
    security_function: "UNRELATED"
    rationale: "License and pragma statements"

  - id: "CA_COMMENTS"
    type: "COMMENT"
    lines: [72, 73, 76, 77, 80, 87, 89, 97, 98, 99, 104, 108, 109, 110, 115, 119, 120, 121, 129, 130, 131, 132]
    security_function: "UNRELATED"
    rationale: "Inline comments and NatSpec documentation"

  - id: "CA_DECLARATIONS"
    type: "DECLARATION"
    lines: [4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 50, 52, 65, 66, 67, 68, 69, 70, 71, 140]
    security_function: "UNRELATED"
    rationale: "Interface, contract, and function signature declarations"

  - id: "CA_SYNTAX"
    type: "SYNTAX"
    lines: [95, 106, 117, 139]
    security_function: "UNRELATED"
    rationale: "Closing braces and structural tokens"

  - id: "CA_EVENT_DEFS"
    type: "EVENT_DEF"
    lines: [18, 19, 20, 21, 22, 55, 56, 57, 58, 59]
    security_function: "UNRELATED"
    rationale: "Event declarations"

summary:
  total_code_acts: 22
  total_lines_covered: 115  # excludes empty lines

  by_security_function:
    ROOT_CAUSE: 1      # CA12
    PREREQ: 0
    BENIGN: 16         # CA1-CA11, CA13-CA17
    UNRELATED: 5       # batched

  root_causes:
    - id: "CA12"
      line: 91
      type: "EXT_CALL"
      description: "Unrestricted external call to any decoded contract"

  prerequisites: []

line_to_code_act:
    1: "CA_DIRECTIVES"
    2: "CA_DIRECTIVES"
    # Line 3: empty
    4: "CA_DECLARATIONS"
    5: "CA_DECLARATIONS"
    # Line 6: empty
    7: "CA_DECLARATIONS"
    8: "CA_DECLARATIONS"
    9: "CA_DECLARATIONS"
    # Line 10: empty
    11: "CA_DECLARATIONS"
    12: "CA_DECLARATIONS"
    # Line 13: empty
    14: "CA_DECLARATIONS"
    15: "CA1"
    16: "CA1"
    # Line 17: empty
    18: "CA_EVENT_DEFS"
    19: "CA_EVENT_DEFS"
    20: "CA_EVENT_DEFS"
    21: "CA_EVENT_DEFS"
    22: "CA_EVENT_DEFS"
    # Line 23: empty
    24: "CA2"
    25: "CA2"
    26: "CA2"
    # Line 27: empty
    28: "CA3"
    29: "CA3"
    30: "CA3"
    31: "CA3"
    # Line 32: empty
    33: "CA4"
    34: "CA4"
    35: "CA4"
    36: "CA4"
    37: "CA4"
    38: "CA4"
    39: "CA4"
    # Line 40: empty
    41: "CA5"
    42: "CA5"
    43: "CA5"
    44: "CA5"
    45: "CA5"
    # Line 46: empty
    47: "CA6"
    48: "CA6"
    49: "CA6"
    50: "CA_DECLARATIONS"
    # Line 51: empty
    52: "CA_DECLARATIONS"
    53: "CA7"
    # Line 54: empty
    55: "CA_EVENT_DEFS"
    56: "CA_EVENT_DEFS"
    57: "CA_EVENT_DEFS"
    58: "CA_EVENT_DEFS"
    59: "CA_EVENT_DEFS"
    # Line 60: empty
    61: "CA8"
    62: "CA8"
    63: "CA8"
    # Line 64: empty
    65: "CA_DECLARATIONS"
    66: "CA_DECLARATIONS"
    67: "CA_DECLARATIONS"
    68: "CA_DECLARATIONS"
    69: "CA_DECLARATIONS"
    70: "CA_DECLARATIONS"
    71: "CA_DECLARATIONS"
    72: "CA_COMMENTS"
    73: "CA_COMMENTS"
    74: "CA9"
    # Line 75: empty
    76: "CA_COMMENTS"
    77: "CA_COMMENTS"
    78: "CA10"
    # Line 79: empty
    80: "CA_COMMENTS"
    81: "CA11"
    82: "CA11"
    83: "CA11"
    84: "CA11"
    85: "CA11"
    # Line 86: empty
    # Line 87: empty
    # Line 88: empty
    89: "CA_COMMENTS"
    # Line 90: empty
    91: "CA12"
    92: "CA13"
    # Line 93: empty
    94: "CA14"
    95: "CA_SYNTAX"
    # Line 96: empty
    97: "CA_COMMENTS"
    98: "CA_COMMENTS"
    99: "CA_COMMENTS"
    100: "CA15"
    101: "CA15"
    102: "CA15"
    103: "CA15"
    104: "CA_COMMENTS"
    105: "CA15"
    106: "CA_SYNTAX"
    # Line 107: empty
    108: "CA_COMMENTS"
    109: "CA_COMMENTS"
    110: "CA_COMMENTS"
    111: "CA16"
    112: "CA16"
    113: "CA16"
    114: "CA16"
    115: "CA_COMMENTS"
    116: "CA16"
    117: "CA_SYNTAX"
    # Line 118: empty
    119: "CA_COMMENTS"
    120: "CA_COMMENTS"
    121: "CA_COMMENTS"
    122: "CA17"
    123: "CA17"
    124: "CA17"
    125: "CA17"
    126: "CA17"
    127: "CA17"
    128: "CA17"
    129: "CA_COMMENTS"
    130: "CA_COMMENTS"
    131: "CA_COMMENTS"
    # Line 132: empty
    133: "CA17"
    134: "CA17"
    135: "CA17"
    136: "CA17"
    137: "CA17"
    138: "CA17"
    139: "CA_SYNTAX"
    140: "CA_DECLARATIONS"
    # Line 141: empty

code_act_security_functions:
  CA1: "BENIGN"
  CA2: "BENIGN"
  CA3: "BENIGN"
  CA4: "BENIGN"
  CA5: "BENIGN"
  CA6: "BENIGN"
  CA7: "BENIGN"
  CA8: "BENIGN"
  CA9: "BENIGN"
  CA10: "BENIGN"
  CA11: "BENIGN"
  CA12: "ROOT_CAUSE"
  CA13: "BENIGN"
  CA14: "BENIGN"
  CA15: "BENIGN"
  CA16: "BENIGN"
  CA17: "BENIGN"
  CA_DIRECTIVES: "UNRELATED"
  CA_COMMENTS: "UNRELATED"
  CA_DECLARATIONS: "UNRELATED"
  CA_SYNTAX: "UNRELATED"
  CA_EVENT_DEFS: "UNRELATED"
