schema_version: "1.0"
sample_id: "ms_tc_023"
vulnerability_type: "signature_verification"
vulnerable_lines: [26, 27, 30]

# Full line coverage for scoring. UNRELATED items are batched for efficiency.
# Detailed rationales only for security-relevant code acts.

code_acts:

  # ============================================
  # SECURITY-RELEVANT CODE ACTS (detailed)
  # ============================================

  - id: "CA1"
    type: "INPUT_VAL"
    lines: [24]
    code: "if (v != 0 || r != bytes32(0) || s != bytes32(0)) {"
    security_function: "BENIGN"
    rationale: "Conditional check for non-zero signature params. This check itself is fine - the issue is CA2 swallowing permit failures."

  - id: "CA2"
    type: "SIGNATURE"
    lines: [26, 27]
    code: |
      try IERC20Permit(token).permit(from, address(this), amount, deadline, v, r, s) {} catch {}
      }
    security_function: "ROOT_CAUSE"
    rationale: "ROOT_CAUSE - The permit() call is a signature verification operation per taxonomy. The try-catch swallows permit failures silently - if signature is invalid, the permit reverts but catch{} ignores it. Function continues executing without verified authorization."

  - id: "CA3"
    type: "CTRL_FLOW"
    lines: [30]
    code: "_anySwapOut(from, token, to, amount, toChainID);"
    security_function: "BENIGN"
    rationale: "Call to internal swap function. This is the downstream consequence of CA2's failure - the vulnerability is already triggered by the swallowed permit."

  - id: "CA4"
    type: "CTRL_FLOW"
    lines: [33, 34, 35]
    code: |
      function _anySwapOut(address from, address token, address to, uint256 amount, uint256 toChainID) internal {
          // Bridge logic - burns or locks tokens
      }
    security_function: "BENIGN"
    rationale: "Internal bridge logic stub. Would execute token operations."

  # ============================================
  # BATCHED UNRELATED CODE ACTS (for scoring)
  # ============================================

  - id: "CA_DIRECTIVES"
    type: "DIRECTIVE"
    lines: [1, 2]
    security_function: "UNRELATED"
    rationale: "License and pragma statements"

  - id: "CA_COMMENTS"
    type: "COMMENT"
    lines: []
    security_function: "UNRELATED"
    rationale: "No standalone comments"

  - id: "CA_DECLARATIONS"
    type: "DECLARATION"
    lines: [4, 5, 6, 8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 31, 36]
    security_function: "UNRELATED"
    rationale: "Interface, contract, and function signature declarations"

  - id: "CA_SYNTAX"
    type: "SYNTAX"
    lines: []
    security_function: "UNRELATED"
    rationale: "Closing braces included in respective code_acts"

summary:
  total_code_acts: 8
  total_lines_covered: 26

  by_security_function:
    ROOT_CAUSE: 1      # CA2
    PREREQ: 0
    BENIGN: 3          # CA1, CA3, CA4
    UNRELATED: 4       # batched

  root_causes:
    - id: "CA2"
      lines: [26, 27]
      type: "SIGNATURE"
      description: "try-catch swallows permit signature verification failures silently"

  prerequisites: []

line_to_code_act:
  1: "CA_DIRECTIVES"
  2: "CA_DIRECTIVES"
  # Line 3: empty
  4: "CA_DECLARATIONS"
  5: "CA_DECLARATIONS"
  6: "CA_DECLARATIONS"
  # Line 7: empty
  8: "CA_DECLARATIONS"
  # Line 9: empty
  10: "CA_DECLARATIONS"
  11: "CA_DECLARATIONS"
  12: "CA_DECLARATIONS"
  13: "CA_DECLARATIONS"
  14: "CA_DECLARATIONS"
  15: "CA_DECLARATIONS"
  16: "CA_DECLARATIONS"
  17: "CA_DECLARATIONS"
  18: "CA_DECLARATIONS"
  19: "CA_DECLARATIONS"
  20: "CA_DECLARATIONS"
  # Line 21: empty
  # Line 22: empty
  # Line 23: empty
  24: "CA1"
  # Line 25: empty
  26: "CA2"
  27: "CA2"
  # Line 28: empty
  # Line 29: empty
  30: "CA3"
  31: "CA_DECLARATIONS"
  # Line 32: empty
  33: "CA4"
  34: "CA4"
  35: "CA4"
  36: "CA_DECLARATIONS"
  # Line 37: empty

code_act_security_functions:
  CA1: "BENIGN"
  CA2: "ROOT_CAUSE"
  CA3: "BENIGN"
  CA4: "BENIGN"
  CA_DIRECTIVES: "UNRELATED"
  CA_COMMENTS: "UNRELATED"
  CA_DECLARATIONS: "UNRELATED"
  CA_SYNTAX: "UNRELATED"
