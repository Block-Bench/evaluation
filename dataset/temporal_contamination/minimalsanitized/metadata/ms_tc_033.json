{
  "sample_id": "ms_tc_033",
  "exploit_name": "Socket Gateway Route Manipulation",
  "timestamp": "2024-01",
  "loss_amount_usd": 3300000,
  "blockchain": "ethereum",
  "vulnerability_type": "access_control",
  "sub_category": "arbitrary_call",
  "severity": "critical",
  "tags": [
    "bridge",
    "arbitrary_call",
    "user_input_validation",
    "approval_exploit",
    "calldata_injection",
    "cross_chain"
  ],
  "difficulty": "advanced",
  "temporal_category": "pre_cutoff",
  "cutoff_date": "2024-01",
  "description": "Socket Gateway, a cross-chain bridge aggregator, was exploited for $3.3M when attackers discovered route 406 accepted arbitrary user-controlled calldata. By injecting transferFrom calls into swapExtraData, attackers drained tokens from any user who had approved the Socket Gateway contract.",
  "vulnerable_lines": [
    39,
    71
  ],
  "vulnerability_details": {
    "root_cause": "User-controlled calldata executed without validation in route contract",
    "attack_vector": "Inject IERC20.transferFrom() calls via swapExtraData parameter to drain approved tokens from victims",
    "vulnerable_functions": [
      "executeRoute()",
      "performAction()"
    ],
    "key_weakness": [
      "Arbitrary external calls with user data",
      "No calldata validation or function selector whitelisting",
      "Unlimited token approvals from users",
      "No recipient address validation",
      "Missing access controls on route functions",
      "No approval scoping mechanism"
    ]
  },
  "attack_flow": [
    "Attacker identifies vulnerable route ID 406 in Socket Gateway",
    "Route's performAction() accepts arbitrary swapExtraData parameter",
    "Attacker finds victims with USDC approval to Socket Gateway",
    "Craft malicious calldata: IERC20.transferFrom(victim, attacker, balance)",
    "Encode malicious calldata into swapExtraData parameter",
    "Call executeRoute(406, encodedPayload) on Socket Gateway",
    "Gateway forwards call to vulnerable route contract",
    "Route executes token.call(swapExtraData) with malicious data",
    "transferFrom succeeds because victim approved Gateway",
    "Drain $3.3M USDC from multiple victims with approvals"
  ],
  "mitigation": [
    "Whitelist allowed function selectors for external calls",
    "Validate all user-controlled calldata before execution",
    "Never execute arbitrary calls with user-provided data",
    "Implement approval scoping (Permit2 pattern)",
    "Add recipient address validation and restrictions",
    "Implement access controls on sensitive route functions",
    "Add pause mechanism for suspicious activity detection",
    "Educate users on limited approvals vs unlimited",
    "Implement route auditing and upgrade procedures"
  ],
  "references": [
    "https://twitter.com/BeosinAlert/status/1747450173675196674",
    "https://twitter.com/peckshield/status/1747353782004900274",
    "https://etherscan.io/address/0x3a23F943181408EAC424116Af7b7790c94Cb97a5"
  ],
  "contract_file": "contracts/ms_tc_033.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "variant_type": "minimalsanitized",
  "variant_parent_id": "tc_033",
  "transformation": {
    "type": "minimal_sanitization",
    "source_dir": "dataset/temporal_contamination/original",
    "source_contract": "dataset/temporal_contamination/original/contracts/tc_033.sol",
    "source_metadata": "dataset/temporal_contamination/original/metadata/tc_033.json",
    "script": "strategies/sanitize/minimal_sanitize.py",
    "changes": [
      "Renamed contract: VulnerableRoute -> Route",
      "Removed 2 vulnerability comment block(s)",
      "Removed 5 vulnerability hint line(s)"
    ],
    "contract_renames": {
      "VulnerableRoute": "Route"
    },
    "created_date": "2025-12-29T22:32:44.550142"
  },
  "vulnerable_contract": "SocketGateway",
  "vulnerable_function": "executeRoute"
}