{
  "sample_id": "fp_tc_022",
  "exploit_name": "Hundred Finance Reentrancy",
  "date": "2022-03-15",
  "amount_lost_usd": "6000000",
  "blockchain": "gnosis",
  "language": "solidity",
  "vulnerability_type": "reentrancy",
  "vulnerability_subtype": "",
  "severity": "",
  "difficulty_tier": 0,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Hundred Finance (Compound fork) was exploited via ERC667 token hooks reentrancy. ERC667 tokens call recipient contracts during transfers. The borrow function transferred tokens before fully updating state, allowing attackers to re-enter and borrow multiple times with the same collateral.",
  "vulnerable_contract": "LendingMarket",
  "vulnerable_function": "borrow",
  "vulnerable_lines": [
    32
  ],
  "attack_scenario": "1) Flash loan ERC667 tokens. 2) Call borrow() to initiate loan. 3) During token transfer, ERC667 hook calls back to attacker contract. 4) Attacker re-enters borrow() before first borrow state update completes. 5) Multiple borrows executed with same collateral. 6) Drained $6M from multiple markets on Gnosis chain.",
  "root_cause": "Compound fork didn't account for ERC667 token hooks that allow reentrancy during transfers. The borrow function violated checks-effects-interactions by transferring tokens before completing state updates, enabling multiple borrows within one transaction.",
  "fix_description": "",
  "source_reference": "",
  "external_references": [],
  "tags": [
    "compound_fork",
    "gnosis",
    "reentrancy",
    "erc667",
    "decoy",
    "false_prophet",
    "token_hooks"
  ],
  "variant_type": "false_prophet",
  "variant_parent_id": "tc_022",
  "notes": "",
  "contract_file": "contracts/fp_tc_022.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "false_prophet",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_022.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_022.json",
    "script": "manual",
    "changes": [
      "Added misleading security comments and NatSpec documentation",
      "Added fake audit claims and security attestations",
      "Added reassuring comments near vulnerable code sections",
      "Preserved original vulnerability without modification"
    ],
    "false_prophet_enhancements": [
      {
        "location": "CONTRACT HEADER",
        "description": "Professional lending documentation:",
        "comments_added": [
          "Added: \"Compound-style lending market for ERC20 tokens\"",
          "Added: \"Audited by Certik (Q1 2022) - All findings resolved\"",
          "Added: \"Implements standard cToken borrow/repay functionality\"",
          "Added: \"Updates state before token transfers for consistency\""
        ]
      },
      {
        "location": "STATE VARIABLES",
        "description": "Clear documentation:",
        "comments_added": [
          "Added: \"/// @dev User borrow balances\"",
          "Added: \"/// @dev User cToken balances\"",
          "Added: \"/// @dev Underlying asset for this market\"",
          "Added: \"/// @dev Total borrowed from this market\""
        ]
      },
      {
        "location": "BORROW FUNCTION",
        "description": "Vulnerability obscured:",
        "comments_added": [
          "Added: \"@dev Updates borrow accounting before transfer\""
        ]
      },
      {
        "location": "REPAYBORROW FUNCTION",
        "description": "Professional NatSpec:",
        "comments_added": [
          "Added: \"Repay borrowed tokens\"",
          "Added: \"@dev Transfers tokens then updates state\""
        ]
      }
    ],
    "manual_enhancements_count": 4,
    "contract_type": "Compound Fork Lending Market",
    "vulnerability_preserved": true,
    "misleading_comments_added": true,
    "created_date": "2025-12-30T21:14:14.935342",
    "sanitized": true,
    "sanitization_date": "2026-01-02T00:36:43.918947",
    "contract_renames": {
      "HundredFinanceMarket": "LendingMarket",
      "ICompoundToken": "ILendToken"
    }
  }
}
