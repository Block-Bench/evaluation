{
  "sample_id": "fp_tc_023",
  "exploit_name": "Alpha Homora Credit Account Manipulation",
  "date": "2021-02-13",
  "amount_lost_usd": "37000000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "accounting_manipulation",
  "vulnerability_subtype": "",
  "severity": "",
  "difficulty_tier": 0,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Alpha Homora V2 integrated with Cream's Iron Bank for leveraged yield farming. The vulnerability was in how debt shares were calculated when totalDebt could be manipulated through external pool state changes. Attackers borrowed funds and manipulated pool reserves to skew the share-to-amount conversion, allowing them to receive far more value than their debt obligations reflected.",
  "vulnerable_contract": {
    "name": "AlphaHomoraBank",
    "functions": [
      {
        "name": "_borrow",
        "vulnerability": "Debt share calculation relies on manipulatable totalDebt value"
      },
      {
        "name": "getPositionDebt",
        "vulnerability": "Returns debt based on potentially manipulated share ratio"
      }
    ]
  },
  "vulnerable_function": "",
  "vulnerable_lines": [],
  "attack_scenario": "1) Attacker opened leveraged position and borrowed initial funds from Iron Bank. 2) Used flash loans to manipulate sUSD/USDC pool reserves. 3) Pool manipulation caused totalDebt calculations to become stale/incorrect. 4) Opened second position with manipulated totalDebt value. 5) Debt share calculation: (borrowAmount * totalDebtShare) / inflatedTotalDebt resulted in fewer shares than deserved. 6) When converting back, attacker's debt appeared much smaller than actual borrowed amount. 7) Repaid calculated debt and withdrew collateral, keeping difference. 8) Repeated to drain $37M.",
  "root_cause": "Debt share calculation depended on totalDebt value that could be manipulated via external pool state changes. The share-to-amount conversion (amount * totalDebtShare / totalDebt) was vulnerable when totalDebt was artificially inflated through pool manipulation, resulting in attackers receiving fewer debt shares than they should for borrowed amounts.",
  "fix_description": "",
  "source_reference": "",
  "external_references": [],
  "tags": [
    "iron_bank",
    "leverage",
    "cream_finance",
    "debt_accounting",
    "share_calculation",
    "flash_loan",
    "decoy",
    "false_prophet"
  ],
  "variant_type": "false_prophet",
  "variant_parent_id": "tc_023",
  "notes": "",
  "contract_file": "contracts/fp_tc_023.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "false_prophet",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_023.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_023.json",
    "script": "manual",
    "changes": [
      "Added misleading security comments and NatSpec documentation",
      "Added fake audit claims and security attestations",
      "Added reassuring comments near vulnerable code sections",
      "Preserved original vulnerability without modification"
    ],
    "false_prophet_enhancements": [
      {
        "location": "CONTRACT HEADER",
        "description": "Professional DeFi documentation:",
        "comments_added": [
          "Added: \"Leveraged yield farming protocol with debt share accounting\"",
          "Added: \"Audited by Peckshield (Q4 2020) - All findings resolved\"",
          "Added: \"Implements share-based debt tracking for interest accrual\"",
          "Added: \"Integrates with Iron Bank for borrowing liquidity\""
        ]
      },
      {
        "location": "STATE VARIABLES",
        "description": "Clear documentation:",
        "comments_added": [
          "Added: \"/// @dev Position data for leveraged farming\"",
          "Added: \"/// @dev Position registry by ID\"",
          "Added: \"/// @dev Counter for position IDs\"",
          "Added: \"/// @dev Iron Bank cToken for borrowing\"",
          "Added: \"/// @dev Total borrowed amount across all positions\"",
          "Added: \"/// @dev Total debt shares for proportional accounting\""
        ]
      }
    ],
    "manual_enhancements_count": 3,
    "contract_type": "Leveraged Yield Farming / Debt Share Accounting",
    "vulnerability_preserved": true,
    "misleading_comments_added": true,
    "created_date": "2025-12-30T21:14:14.933965"
  }
}