{
  "id": "uranium_finance_2021_04",
  "exploit_name": "Uranium Finance AMM Miscalculation",
  "date": "2021-04-28",
  "blockchain": "binance_smart_chain",
  "amount_lost_usd": "50000000",
  "vulnerability_type": "arithmetic_error",
  "difficulty": 4,
  "tags": [
    "amm",
    "uniswap_fork",
    "constant_product",
    "calculation_error",
    "bsc",
    "precision_mismatch"
  ],
  "description": "Uranium Finance forked Uniswap V2 and changed the swap fee from 0.3% to 0.16%, updating the fee calculation denominator from 1000 to 10000. However, they failed to update the constant product (K) validation check to use the same scale. The adjusted balances used scale 10000, but the K check compared against reserves * 1000^2, creating a 100x mismatch that allowed K to inflate after each swap.",
  "attack_scenario": "1) Attacker deposited tokens into Uranium WBNB/BUSD pool. 2) Executed swap with amount0In. 3) K validation: left side (balance * 10000) vs right side (reserve * 1000^2) created 100x discrepancy. 4) Check passed even though K actually increased 100x. 5) Swapped back in opposite direction with even more inflated K. 6) Each swap cycle further inflated the constant product. 7) After 5-10 iterations, attacker drained $50M by extracting more tokens than deposited. Pool became completely imbalanced.",
  "vulnerable_contract": "SwapPair",
  "root_cause": "When changing the fee from 0.3% to 0.16%, developers updated the fee calculation to use denominator 10000 instead of 1000. However, the constant product invariant check still used the old 1000 scale (reserve0 * reserve1 * 1000^2) instead of the new scale (reserve0 * reserve1 * 10000^2). This created a 100x mismatch allowing K to inflate after swaps.",
  "vulnerable_lines": [
    92
  ],
  "fix": "Update the constant product check to use consistent scaling: require(balance0Adjusted * balance1Adjusted >= uint256(_reserve0) * _reserve1 * (10000 ** 2), 'K'). The magic number must match the scale used in balance adjustments. Better: use a constant for the scale factor to prevent such mismatches.",
  "references": [
    "https://twitter.com/FrankResearcher/status/1387347025742557186",
    "https://medium.com/immunefi/building-a-poc-for-the-uranium-heist-ec83fbd83e9f",
    "https://bscscan.com/tx/0x5a504fe72ef7fc76dfeb4d979e533af4e23fe37e90b5516186d5787893c37991"
  ],
  "temporal_category": "pre_cutoff",
  "variant_type": "nocomments",
  "checks_effects_interactions_violated": false,
  "involves_external_calls": true,
  "contract_file": "contracts/nc_tc_019.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "nc_tc_019",
  "variant_parent_id": "sn_tc_019",
  "transformation": {
    "type": "comment_removal",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/sanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/sanitized/contracts/sn_tc_019.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/sanitized/metadata/sn_tc_019.json",
    "script": "strategies/nocomments/nocomments_tc.py",
    "changes": [
      "Removed 11 comments (single-line and multi-line)",
      "Regenerated fresh line markers"
    ],
    "comments_removed": 11,
    "created_date": "2025-12-31T20:00:38.851001"
  },
  "vulnerable_function": "swap",
  "sanitized_from": "ms_tc_019",
  "is_vulnerable": true
}