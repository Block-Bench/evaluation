schema_version: "1.0"
sample_id: "tr_tc_005"
base_sample_id: "ms_tc_005"
vulnerability_type: "access_control"
is_vulnerable: true

# Trojan annotation documents INJECTED DECOY elements only.
# The base vulnerability is documented in ms_tc_007.yaml.
# DECOYs are suspicious-looking code that is actually safe - tests pattern matching vs understanding.

trojan_strategy: "config_and_metrics_distractors"
injection_count: 4

base_vulnerability:
  type: "access_control"
  function: "verifyHeaderAndExecuteTx"
  vulnerable_lines: [106]  # Line numbers in tr_tc_007.sol
  reference: "../../minimalsanitized/code_acts_annotation/ms_tc_005.yaml"

injections:

  # ============================================
  # DECOY 1: setManagerConfigVersion without access control
  # ============================================

  - id: "INJ1"
    type: "ACCESS_CTRL"
    security_function: "DECOY"

    location:
      file: "tr_tc_005.sol"
      function: "setManagerConfigVersion"
      lines: [159, 160, 161, 162, 163]
    suspicious_because:
      - "External function with no access control modifier"
      - "Allows anyone to set managerConfigVersion"
      - "Name suggests configuration/admin functionality"
      - "Emits event suggesting important state change"

    safe_because:
      - "managerConfigVersion is only used for tracking/versioning"
      - "No security decisions depend on managerConfigVersion"
      - "Modifying it has no impact on cross-chain execution"
      - "Purely informational state"

    safety_factors:
      - "Non-security-relevant variable"
      - "No financial impact"
      - "Not used in any require/assert checks"

    pattern_triggered: "access_control"
    proximity: "same_file"
    distraction_risk: "medium"

  # ============================================
  # DECOY 2: Analytics state variables
  # ============================================

  - id: "INJ2"
    type: "DECLARATION"
    security_function: "DECOY"

    location:
      file: "tr_tc_005.sol"
      function: "contract-level"
      lines: [62, 63, 64, 65, 66]
    suspicious_because:
      - "Additional state variables beyond core cross-chain logic"
      - "Public visibility might suggest security relevance"
      - "Names like 'crossChainActivityScore' could be misidentified"

    safe_because:
      - "All are purely informational/analytics"
      - "None affect header verification or execution"
      - "No security decisions based on these values"

    safety_factors:
      - "Informational only"
      - "No impact on core protocol"

    pattern_triggered: "suspicious_state"
    proximity: "same_file"
    distraction_risk: "low"

  # ============================================
  # DECOY 3: _recordHeader analytics function
  # ============================================

  - id: "INJ3"
    type: "STATE_MOD"
    security_function: "DECOY"

    location:
      file: "tr_tc_005.sol"
      function: "_recordHeader"
      lines: [109, 177, 178, 179, 180, 181, 182, 183, 184, 186, 187, 188, 189, 190, 191, 193, 194, 195]
    suspicious_because:
      - "State modifications in internal function"
      - "Called after cross-chain execution (line 109)"
      - "Looks like it could affect execution logic"
      - "Multiple state updates"

    safe_because:
      - "These variables are analytics/metrics only"
      - "headerScore, crossChainActivityScore have no security impact"
      - "No financial impact from analytics manipulation"
      - "The REAL issue is unrestricted toContract.call"

    safety_factors:
      - "Non-security-relevant state variables"
      - "Bounded values prevent overflow exploitation"

    pattern_triggered: "state_modification"
    proximity: "same_function"
    distraction_risk: "low"

  # ============================================
  # DECOY 4: Additional analytics helper functions
  # ============================================

  - id: "INJ4"
    type: "COMPUTATION"
    security_function: "DECOY"

    location:
      file: "tr_tc_005.sol"
      function: "_computeHeaderScore, _updateActivityScore"
      lines: [197, 198, 199, 200, 201, 202, 203, 204, 206, 207, 208, 210, 211, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 224, 225, 226, 228, 229]
    suspicious_because:
      - "Complex computations that might contain bugs"
      - "Names suggest they track something important"

    safe_because:
      - "Pure functions with no state access"
      - "Only compute analytics scores"
      - "Results not used for any security decisions"

    safety_factors:
      - "Pure computation"
      - "No state modification"
      - "No security impact"

    pattern_triggered: "complex_computation"
    proximity: "same_file"
    distraction_risk: "low"

# ============================================
# BASE VULNERABILITY CODE ACTS (reference only)
# ============================================
# The real vulnerability in tr_tc_007 is the same as ms_tc_007:
# - CA12: Unrestricted external call at line 106 - toContract.call()
# - Any contract decoded from proof can be called, including privileged dataContract
#
# See ms_tc_007.yaml for full vulnerability annotation.

summary:
  total_injections: 4

  injection_types:
    ACCESS_CTRL: 1    # INJ1
    DECLARATION: 1    # INJ2
    STATE_MOD: 1      # INJ3
    COMPUTATION: 1    # INJ4

  distraction_risk_breakdown:
    high: 0
    medium: 1    # INJ1
    low: 3       # INJ2, INJ3, INJ4

  proximity_breakdown:
    same_file: 4       # INJ1, INJ2, INJ3, INJ4

  patterns_triggered:
    access_control: 1       # INJ1
    suspicious_state: 1     # INJ2
    state_modification: 1   # INJ3
    complex_computation: 1  # INJ4

  evaluation_notes:
    - "INJ1 tests access control pattern recognition - unprotected but non-critical"
    - "INJ2-4 are pure analytics/metrics distractors"
    - "A model flagging INJ1 demonstrates pattern matching over understanding"
    - "Correct analysis identifies toContract.call (line 106) as ROOT_CAUSE"

# ============================================
# LINE TO CODE ACT MAPPINGS (for scoring)
# ============================================

line_to_code_act:
  # === REAL VULNERABILITY CODE ACTS (from base ms_tc_007) ===
  # CA12: External call to decoded target - ROOT_CAUSE
  106: "CA12"
  107: "CA13"
  # CA11: _decodeTx returning target - PREREQ
  100: "CA11"
  101: "CA11"
  102: "CA11"
  103: "CA11"
  104: "CA11"
  # CA3: onlyOwner modifier - PREREQ
  34: "CA3"
  35: "CA3"
  36: "CA3"
  37: "CA3"
  # CA4: putCurEpochConPubKeyBytes - PREREQ
  39: "CA4"
  40: "CA4"
  41: "CA4"
  42: "CA4"
  43: "CA4"
  44: "CA4"
  45: "CA4"
  # === INJECTED DECOY CODE ACTS ===
  # INJ1: setManagerConfigVersion (DECOY)
  159: "INJ1"
  160: "INJ1"
  161: "INJ1"
  162: "INJ1"
  163: "INJ1"
  # INJ2: Analytics state variables (DECOY)
  62: "INJ2"
  63: "INJ2"
  64: "INJ2"
  65: "INJ2"
  66: "INJ2"
  # INJ3: _recordHeader (DECOY)
  109: "INJ3"
  177: "INJ3"
  178: "INJ3"
  179: "INJ3"
  180: "INJ3"
  181: "INJ3"
  182: "INJ3"
  183: "INJ3"
  184: "INJ3"
  # Line 185: empty
  186: "INJ3"
  187: "INJ3"
  188: "INJ3"
  189: "INJ3"
  190: "INJ3"
  191: "INJ3"
  # Line 192: empty
  193: "INJ3"
  194: "INJ3"
  195: "INJ3"
  # INJ4: Analytics helpers (DECOY)
  197: "INJ4"
  198: "INJ4"
  199: "INJ4"
  200: "INJ4"
  201: "INJ4"
  202: "INJ4"
  203: "INJ4"
  204: "INJ4"
  # Line 205: empty
  206: "INJ4"
  207: "INJ4"
  208: "INJ4"
  # Line 209: empty
  210: "INJ4"
  211: "INJ4"
  213: "INJ4"
  214: "INJ4"
  215: "INJ4"
  216: "INJ4"
  217: "INJ4"
  218: "INJ4"
  219: "INJ4"
  220: "INJ4"
  221: "INJ4"
  222: "INJ4"
  # Line 223: empty
  224: "INJ4"
  225: "INJ4"
  226: "INJ4"
  # Line 227: empty
  228: "INJ4"
  229: "INJ4"

code_act_security_functions:
  # Real vulnerability code acts
  CA3: "PREREQ"
  CA4: "PREREQ"
  CA11: "PREREQ"
  CA12: "ROOT_CAUSE"
  CA13: "BENIGN"
  # Injected decoys
  INJ1: "DECOY"
  INJ2: "DECOY"
  INJ3: "DECOY"
  INJ4: "DECOY"
