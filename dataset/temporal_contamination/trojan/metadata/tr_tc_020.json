{
  "sample_id": "tr_tc_020",
  "exploit_name": "Warp Finance LP Token Price Manipulation",
  "date": "2020-12-17",
  "amount_lost_usd": "7700000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "price_oracle_manipulation",
  "vulnerability_subtype": "",
  "severity": "",
  "difficulty_tier": 0,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Warp Finance allowed users to deposit Uniswap LP tokens as collateral and borrow stablecoins. The protocol calculated LP token value using current pool reserves without protection against flash loan manipulation. An attacker used flash loans to massively imbalance a Uniswap pool, inflating the calculated value of their LP tokens, then borrowed far more than their collateral's true worth.",
  "vulnerable_contract": "LendingVault",
  "vulnerable_function": "",
  "vulnerable_lines": [],
  "attack_scenario": "1) Flash loan 5M DAI. 2) Swap DAI -> ETH in Uniswap pool, heavily imbalancing reserves (6M DAI, 100 ETH). 3) LP token value calculation uses manipulated reserves, showing inflated value. 4) Deposit LP tokens as collateral in Warp Finance. 5) Borrow maximum stablecoins based on inflated collateral valuation (2-3x more than true value). 6) Swap back to rebalance pool. 7) Repay flash loan. 8) Keep overborrowed funds. Loss: $7.7M.",
  "root_cause": "LP token value was calculated directly from current Uniswap pool reserves without using time-weighted average prices (TWAP) or external oracles. Flash loan attackers could temporarily manipulate pool reserves within a single transaction, inflating the perceived value of LP tokens and overborrowing against them.",
  "fix_description": "",
  "source_reference": "",
  "external_references": [],
  "tags": [
    "flash_loan",
    "lp_tokens",
    "uniswap",
    "price_manipulation",
    "oracle",
    "collateral_valuation",
    "defi_lending",
    "trojan"
  ],
  "variant_type": "trojan",
  "variant_parent_id": "tc_020",
  "notes": "",
  "contract_file": "contracts/tr_tc_020.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "trojan",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/contracts/tc_020.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/metadata/tc_020.json",
    "script": "manual",
    "changes": [
      "Removed vulnerability documentation and comments",
      "Added distractor code (fake security metrics, config tracking)",
      "Added suspicious-named variables as red herrings",
      "Preserved original vulnerability",
      "Renamed contracts to generic names"
    ],
    "distractors": {
      "config_variables": 2,
      "score_variables": 16,
      "activity_variables": 0,
      "fake_functions": 3,
      "view_helpers": 2,
      "suspicious_names": 18
    },
    "contracts_renamed": [
      "LendingVault"
    ],
    "vulnerability_preserved": true,
    "documentation_removed": true,
    "created_date": "2025-12-30T01:40:33.659408"
  }
}