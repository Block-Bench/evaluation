schema_version: "1.0"
sample_id: "df_tc_023"
base_sample_id: "ms_tc_023"
vulnerability_type: "signature_verification"
is_fixed: true

fix_summary:
  description: "Direct permit call without try-catch swallowing failures"
  fix_type: "permit_validation"
  vulnerable_pattern: "try-catch swallowed permit failures"
  fixed_pattern: "Direct permit call reverts on failure"

vulnerable_version:
  reference: "../minimalsanitized/code_acts_annotation/ms_tc_023.yaml"
  root_cause_description: "try-catch swallowed permit failures silently"

fixed_version:
  fix_lines: [23]
  fix_description: "Direct permit call without try-catch"

code_acts:

  - id: "CA_FIX1"
    type: "EXT_CALL"
    lines: [23]
    code: "IERC20Permit(token).permit(from, address(this), amount, deadline, v, r, s);"
    security_function: "BENIGN"
    rationale: "FIX - Direct permit call that reverts on failure"

  - id: "CA1"
    type: "INPUT_VAL"
    lines: [22]
    code: "if (v != 0 || r != bytes32(0) || s != bytes32(0)) {"
    security_function: "BENIGN"
    rationale: "Check for non-zero signature"

  - id: "CA2"
    type: "CTRL_FLOW"
    lines: [24]
    code: "}"
    security_function: "BENIGN"
    rationale: "If statement close"

  - id: "CA3"
    type: "CTRL_FLOW"
    lines: [26, 27]
    code: |
      _bridgeOut(from, token, to, amount, toChainID);
      }
    security_function: "BENIGN"
    rationale: "Bridge out call"

  - id: "CA4"
    type: "CTRL_FLOW"
    lines: [29, 30, 31]
    code: |
      function _bridgeOut(address from, address token, address to, uint256 amount, uint256 toChainID) internal {
          // Bridge logic
      }
    security_function: "BENIGN"
    rationale: "Internal bridge function"

  - id: "CA_DIRECTIVES"
    type: "DIRECTIVE"
    lines: [1, 2]
    security_function: "UNRELATED"
    rationale: "License and pragma"

  - id: "CA_COMMENTS"
    type: "COMMENT"
    lines: [30]
    security_function: "UNRELATED"
    rationale: "Bridge logic comment"

  - id: "CA_DECLARATIONS"
    type: "DECLARATION"
    lines: [4, 5, 6, 8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
    security_function: "UNRELATED"
    rationale: "Interface and function declarations"

  - id: "CA_SYNTAX"
    type: "SYNTAX"
    lines: []
    security_function: "UNRELATED"
    rationale: "Braces included in code_acts"

summary:
  total_code_acts_fixed: 9

  fix_applied:
    type: "permit_validation"
    description: "Direct permit call"
    lines_changed: [23]

  by_security_function_fixed:
    BENIGN: 5
    UNRELATED: 4

line_to_code_act_fixed:
  1: "CA_DIRECTIVES"
  2: "CA_DIRECTIVES"
  4: "CA_DECLARATIONS"
  5: "CA_DECLARATIONS"
  6: "CA_DECLARATIONS"
  8: "CA_DECLARATIONS"
  10: "CA_DECLARATIONS"
  11: "CA_DECLARATIONS"
  12: "CA_DECLARATIONS"
  13: "CA_DECLARATIONS"
  14: "CA_DECLARATIONS"
  15: "CA_DECLARATIONS"
  16: "CA_DECLARATIONS"
  17: "CA_DECLARATIONS"
  18: "CA_DECLARATIONS"
  19: "CA_DECLARATIONS"
  20: "CA_DECLARATIONS"
  22: "CA1"
  23: "CA_FIX1"
  24: "CA2"
  26: "CA3"
  27: "CA3"
  29: "CA4"
  30: "CA_COMMENTS"
  31: "CA4"
  32: "CA4"

code_act_security_functions_fixed:
  CA_FIX1: "BENIGN"
  CA1: "BENIGN"
  CA2: "BENIGN"
  CA3: "BENIGN"
  CA4: "BENIGN"
  CA_DIRECTIVES: "UNRELATED"
  CA_COMMENTS: "UNRELATED"
  CA_DECLARATIONS: "UNRELATED"
  CA_SYNTAX: "UNRELATED"
