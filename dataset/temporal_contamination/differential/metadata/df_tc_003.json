{
  "sample_id": "df_tc_003",
  "exploit_name": "Parity Wallet",
  "date": "2017-11-06",
  "amount_lost_usd": "150000000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "access_control",
  "vulnerability_subtype": "unprotected_initialization_delegatecall",
  "severity": "critical",
  "difficulty_tier": 4,
  "is_vulnerable": false,
  "temporal_category": "pre_cutoff",
  "description": "Fixed version with initialization check and access control on kill function",
  "vulnerable_contract": "for",
  "vulnerable_function": "initWallet",
  "vulnerable_lines": [],
  "attack_scenario": "User calls initWallet() directly on the WalletLibrary contract (not via delegatecall from a proxy), becoming the owner of the library itself. User then calls kill() function which executes selfdestruct, destroying the library contract. All 587 wallet proxies that delegatecall to this library are now permanently frozen with no way to access funds.",
  "root_cause": "The library contract's initWallet() function had no access control preventing direct calls. Combined with a kill() function containing selfdestruct, this allowed anyone to destroy the shared library that all wallets depended on.",
  "fix_description": "Library contracts should not have initialization functions callable directly (only via delegatecall). Remove selfdestruct from library contracts entirely. Use Solidity's 'library' keyword instead of 'contract' for shared logic. Add explicit access controls checking deployment context. Use modern upgradeable proxy patterns (EIP-1967) with proper initialization guards. Separate proxy storage from library logic clearly.",
  "source_reference": "https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2017-11/Parity_kill_exp.sol",
  "external_references": [
    "https://github.com/openethereum/parity-ethereum/issues/6995",
    "https://www.parity.io/blog/a-postmortem-on-the-parity-multi-sig-library-self-destruct",
    "https://etherscan.io/address/0x863df6bfa4469f3ead0be8f9f2aae51c91a907b4"
  ],
  "tags": [
    "delegatecall",
    "selfdestruct",
    "proxy_pattern",
    "library",
    "initialization",
    "access_control",
    "historical",
    "differential",
    "fixed"
  ],
  "variant_type": "differential",
  "variant_parent_id": "tc_003",
  "notes": "Historic Ethereum bug from 2017. Funds remain frozen to this day. Triggered accidentally by a user testing functions, not by a malicious attacker. Demonstrated the extreme danger of selfdestruct in shared library contracts. Led to significant changes in how proxy patterns are implemented.",
  "contract_file": "contracts/df_tc_003.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "differential",
    "strategy": "minimal_fix",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/contracts/tc_003.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/metadata/tc_003.json",
    "pair_metadata": "/Users/poamen/projects/grace/blockbench/base/data/manual_strategies/differential/metadata/df_pair_tc_003.json",
    "script": "manual",
    "is_fixed_version": true,
    "fix_type": "initialization_guard_and_access_control",
    "fix_description": "Added require check for initialization in initWallet (line 22) and require for initialization in kill (line 60) to prevent unauthorized initialization and selfdestruct. Removed ability to reinitialize or destroy uninitialized library.",
    "exact_changes": [
      {
        "location": "initWallet function (line 22)",
        "version_a": "require(!initialized, \"Already initialized\");",
        "version_b": "// No initialization check"
      },
      {
        "location": "kill function (line 60)",
        "version_a": "require(initialized && msg.sender == owner, \"Not authorized\");",
        "version_b": "// No access control on selfdestruct"
      }
    ],
    "why_fix_works": "The minimal fix prevents the catastrophic scenario where anyone can take ownership of the library and destroy it, permanently freezing all dependent wallet contracts.",
    "contracts_in_file": [
      "for",
      "WalletLibrary",
      "that",
      "WalletProxy"
    ],
    "created_date": "2025-12-30T02:02:17.924533"
  }
}