{
  "id": "rari_capital_2022",
  "exploit_name": "Rari Capital Fuse",
  "date": "2022-05-08",
  "blockchain": "ethereum",
  "amount_stolen_usd": "80000000",
  "amount_stolen_crypto": "Various",
  "vulnerability_type": "reentrancy",
  "attack_type": "cross_function_reentrancy",
  "difficulty": 4,
  "impact": "critical",
  "description": "Cross-function reentrancy attack. The borrow function sent ETH before final health check, allowing attacker to call exitMarket during callback and bypass collateral requirements.",
  "root_cause": "Cross-function reentrancy. Borrow sent ETH (triggering callback) before final validation. Attacker called exitMarket during callback, modifying shared state (inMarket) and bypassing health checks.",
  "attack_scenario": "Attacker deposited collateral and entered market, called borrow to get ETH. During ETH transfer callback, attacker called exitMarket to remove collateral requirement. Final health check used stale state, allowing over-borrowing.",
  "vulnerable_contract": "LendingHub",
  "vulnerable_function": "borrow",
  "vulnerable_lines": [
    68,
    71,
    76
  ],
  "fix_description": "Use global ReentrancyGuard on all functions that share state. Perform all validations after external calls. Prevent exitMarket when positions are open. Consider mutex locks for cross-function protection.",
  "tags": [
    "reentrancy",
    "cross-function",
    "oracle-manipulation",
    "health-check"
  ],
  "references": [
    "https://www.blocksecteam.com/blog/2022/05/rari-capital-fuse-pool-hack/",
    "https://twitter.com/FeiProtocol/status/1520847142650499072"
  ],
  "historical_significance": "Demonstrated sophisticated cross-function reentrancy. Shows that per-function reentrancy guards aren't sufficient when multiple functions share state.",
  "compiler_version": "0.8.0",
  "is_pre_cutoff": true,
  "cutoff_date": "2024-01-01",
  "contract_file": "contracts/sn_tc_012.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "sn_tc_012",
  "variant_type": "sanitized",
  "variant_parent_id": "tc_012",
  "transformation": {
    "type": "full_sanitization_from_minimalsanitized",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_012.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_012.json",
    "original_id": "tc_012",
    "minimalsanitized_id": "ms_tc_012",
    "script": "strategies/sanitize/sanitize_on_minimal_sanitize.py",
    "changes": [
      "Renamed: RariFuse \u2192 LendingHub"
    ],
    "contract_renames": {
      "RariFuse": "LendingHub"
    },
    "created_date": "2025-12-31T20:00:32.039693"
  },
  "sanitized_from": "ms_tc_012"
}