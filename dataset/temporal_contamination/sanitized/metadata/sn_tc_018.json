{
  "id": "indexed_finance_2021_10",
  "exploit_name": "Indexed Finance Pool Manipulation",
  "date": "2021-10-14",
  "blockchain": "ethereum",
  "amount_lost_usd": "16000000",
  "vulnerability_type": "pool_manipulation",
  "difficulty": 4,
  "tags": [
    "flash_loan",
    "pool_manipulation",
    "weight_manipulation",
    "defi",
    "index_funds",
    "oracle_free_pricing"
  ],
  "description": "Attacker exploited Indexed Finance's pool weight recalculation mechanism. By using flash loans to massively drain liquidity of a single token, the attacker caused the pool's internal weight calculation to become extremely skewed. The vulnerability was that token weights were updated based on instantaneous balances after each swap, rather than using time-weighted averages or external oracles.",
  "attack_scenario": "1) Flash loan large amounts of SUSHI, UNI, and other index tokens. 2) Execute massive swaps to drain almost all of a target token (DEFI5) from the pool. 3) Pool's _updateWeights() function recalculates weights based on the new unbalanced state. 4) Target token now has extremely low weight (~1%), making it undervalued. 5) Buy back the drained token at manipulated low prices. 6) Repay flash loans and profit from price discrepancy. Loss: $16M.",
  "vulnerable_contract": "IndexPool",
  "root_cause": "Token weights in index pools were recalculated based on instantaneous token balances after swaps. Flash loan attackers could temporarily drain liquidity of a single token, causing weight recalculation to heavily undervalue that token, then buy it back at manipulated prices.",
  "vulnerable_lines": [
    56,
    101
  ],
  "fix": "Use time-weighted average prices (TWAP) or external price oracles instead of instantaneous balance-based weight calculations. Implement gradual weight adjustments over multiple blocks rather than immediate updates.",
  "references": [
    "https://blocksecteam.medium.com/the-analysis-of-indexed-finance-security-incident-8a62b9799836",
    "https://twitter.com/Mudit__Gupta/status/1448884940964188167",
    "https://etherscan.io/tx/0x44aad3b853866468161735496a5d9cc961ce5aa872924c5d78673076b1cd95aa"
  ],
  "temporal_category": "pre_cutoff",
  "variant_type": "sanitized",
  "checks_effects_interactions_violated": false,
  "involves_external_calls": true,
  "contract_file": "contracts/sn_tc_018.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "sn_tc_018",
  "variant_parent_id": "tc_018",
  "transformation": {
    "type": "full_sanitization_from_minimalsanitized",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_018.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_018.json",
    "original_id": "tc_018",
    "minimalsanitized_id": "ms_tc_018",
    "script": "strategies/sanitize/sanitize_on_minimal_sanitize.py",
    "changes": [
      "Removed comment: // In real implementation, this would use oracle p..."
    ],
    "contract_renames": {},
    "created_date": "2025-12-31T20:00:32.093134"
  },
  "vulnerable_function": "_updateWeights",
  "sanitized_from": "ms_tc_018"
}