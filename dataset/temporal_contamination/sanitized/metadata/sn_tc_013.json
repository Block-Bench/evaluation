{
  "id": "bzx_protocol_2020",
  "exploit_name": "bZx Protocol",
  "date": "2020-09-14",
  "blockchain": "ethereum",
  "amount_stolen_usd": "8000000",
  "amount_stolen_crypto": "Various",
  "vulnerability_type": "reentrancy",
  "attack_type": "transfer_callback_manipulation",
  "difficulty": 3,
  "impact": "high",
  "description": "Transfer callback manipulation allowing state inconsistency. The transfer function updated balances then called _notifyTransfer which triggered callbacks, allowing repeated transfers with stale state calculations.",
  "root_cause": "Token transfer function called external contract during state update. Callback occurred after balance updates but before finalization, creating state inconsistency exploitable through repeated self-transfers.",
  "attack_scenario": "Attacker minted tokens, then transferred to self 4 times in loop. Each transfer triggered callback with inconsistent state. After iterations, token balance inflated. Burned inflated tokens back to ETH for profit.",
  "vulnerable_contract": "MarginToken",
  "vulnerable_function": "transfer",
  "vulnerable_lines": [
    59,
    78
  ],
  "fix_description": "Add reentrancy guard to transfer function. Remove callbacks from transfer entirely, or ensure all state updates complete before any external calls. Use CEI pattern strictly.",
  "tags": [
    "reentrancy",
    "callback-manipulation",
    "token-transfer",
    "state-inconsistency"
  ],
  "references": [
    "https://etherscan.io/tx/0x85dc2a433fd9eaadaf56fd8156c956da23fc17e5ef83955c7e2c4c37efa20bb5",
    "https://twitter.com/0xCommodity/status/1305354469354303488"
  ],
  "historical_significance": "One of multiple bZx exploits in 2020. Showed danger of callbacks in token transfers. Led to simpler transfer implementations in DeFi protocols.",
  "compiler_version": "0.8.0",
  "is_pre_cutoff": true,
  "cutoff_date": "2024-01-01",
  "contract_file": "contracts/sn_tc_013.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "sn_tc_013",
  "variant_type": "sanitized",
  "variant_parent_id": "tc_013",
  "transformation": {
    "type": "full_sanitization_from_minimalsanitized",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_013.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_013.json",
    "original_id": "tc_013",
    "minimalsanitized_id": "ms_tc_013",
    "script": "strategies/sanitize/sanitize_on_minimal_sanitize.py",
    "changes": [
      "Renamed: BZXLoanToken \u2192 MarginToken"
    ],
    "contract_renames": {
      "BZXLoanToken": "MarginToken"
    },
    "created_date": "2025-12-31T20:00:32.074357"
  },
  "sanitized_from": "ms_tc_013"
}
