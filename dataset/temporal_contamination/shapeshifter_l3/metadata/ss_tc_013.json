{
  "id": "bzx_protocol_2020",
  "exploit_name": "bZx Protocol",
  "date": "2020-09-14",
  "blockchain": "ethereum",
  "amount_stolen_usd": "8000000",
  "amount_stolen_crypto": "Various",
  "vulnerability_type": "reentrancy",
  "attack_type": "transfer_callback_manipulation",
  "difficulty": 3,
  "impact": "high",
  "description": "Transfer callback manipulation allowing state inconsistency. The transfer function updated balances then called _notifyTransfer which triggered callbacks, allowing repeated transfers with stale state calculations.",
  "root_cause": "Token transfer function called external contract during state update. Callback occurred after balance updates but before finalization, creating state inconsistency exploitable through repeated self-transfers.",
  "attack_scenario": "Attacker minted tokens, then transferred to self 4 times in loop. Each transfer triggered callback with inconsistent state. After iterations, token balance inflated. Burned inflated tokens back to ETH for profit.",
  "vulnerable_contract": "MarginToken",
  "vulnerable_function": "transfer",
  "vulnerable_lines": [
    27,
    36
  ],
  "fix_description": "Add reentrancy guard to transfer function. Remove callbacks from transfer entirely, or ensure all state updates complete before any external calls. Use CEI pattern strictly.",
  "tags": [
    "reentrancy",
    "callback-manipulation",
    "token-transfer",
    "state-inconsistency"
  ],
  "references": [
    "https://etherscan.io/tx/0x85dc2a433fd9eaadaf56fd8156c956da23fc17e5ef83955c7e2c4c37efa20bb5",
    "https://twitter.com/0xCommodity/status/1305354469354303488"
  ],
  "historical_significance": "One of multiple bZx exploits in 2020. Showed danger of callbacks in token transfers. Led to simpler transfer implementations in DeFi protocols.",
  "compiler_version": "0.8.0",
  "is_pre_cutoff": true,
  "cutoff_date": "2024-01-01",
  "contract_file": "contracts/ss_tc_013.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "ss_tc_013",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_013",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_013.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_013.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 21 identifiers using hex style",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "totalAssetSupply": "_0x390062",
      "totalAssetBorrow": "_0x0cce35",
      "_notifyTransfer": "_0x8cd0a4",
      "mintWithEther": "_0x7d6277",
      "currentPrice": "_0x7248ad",
      "burnToEther": "_0x477183",
      "totalSupply": "_0x347a3f",
      "_tokenPrice": "_0x2c833f",
      "_isContract": "_0xd80623",
      "mintAmount": "_0x1045d1",
      "balanceOf": "_0x0f4194",
      "ethAmount": "_0x2ff8d2",
      "receiver": "_0x6ff151",
      "balances": "_0x771f54",
      "account": "_0x0d961f",
      "success": "_0x65ce0c",
      "amount": "_0xd6cb4d",
      "symbol": "_0x70dd97",
      "size": "_0xe5feba",
      "name": "_0x8e6f03",
      "to": "_0x0353ce"
    },
    "coverage_percent": 67.74,
    "identifiers_transformed": 21,
    "created_date": "2025-12-31T19:59:41.169844"
  },
  "sanitized_from": "ms_tc_013",
  "is_vulnerable": true
}