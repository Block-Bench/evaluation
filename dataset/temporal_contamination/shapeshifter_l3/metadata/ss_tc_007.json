{
  "sample_id": "ss_tc_007",
  "exploit_name": "Poly Network",
  "date": "2021-08-10",
  "amount_lost_usd": "611000000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "access_control",
  "vulnerability_subtype": "unrestricted_target_execution",
  "severity": "critical",
  "difficulty_tier": 4,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Poly Network cross-chain bridge vulnerability where EthCrossChainManager allowed executing cross-chain transactions targeting ANY contract, including the privileged EthCrossChainData contract. Attacker crafted transaction targeting EthCrossChainData to call putCurEpochConPubKeyBytes() which passed onlyOwner check (msg.sender was EthCrossChainManager), allowing attacker to set their own validator keys and drain $611M.",
  "vulnerable_contract": "CrossChainManager",
  "vulnerable_function": "_0x8cd0a4",
  "vulnerable_lines": [
    64
  ],
  "attack_scenario": "Attacker creates valid cross-chain transaction on Poly Network sidechain with target set to EthCrossChainData (the privileged data contract), not a user contract. Transaction calls putCurEpochConPubKeyBytes() to change validator public keys. EthCrossChainManager verifies header signatures and Merkle proof (both valid), then executes transaction by calling EthCrossChainData. Since msg.sender is EthCrossChainManager, the onlyOwner check passes. Attacker's keys become validator keys, allowing them to forge any cross-chain transaction and drain bridge.",
  "root_cause": "EthCrossChainManager validated cross-chain transactions (headers, proofs) but didn't restrict which contracts could be targeted for execution. It allowed calling EthCrossChainData, which trusted EthCrossChainManager as owner. This created an access control bypass where anyone could call privileged functions on EthCrossChainData by routing through EthCrossChainManager with a valid cross-chain transaction.",
  "fix_description": "Implement whitelist of allowed target contracts, explicitly excluding privileged contracts like EthCrossChainData. Use blacklist to forbid critical system contracts as targets. Separate privilege levels for cross-chain execution. Replace msg.sender-based authorization with more granular access controls. Add multi-sig requirements for critical operations like validator key updates. Implement emergency pause mechanisms. Add rate limiting and anomaly detection for cross-chain transactions.",
  "source_reference": "https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2021-08/PolyNetwork_exp.sol",
  "external_references": [
    "https://rekt.news/polynetwork-rekt/",
    "https://research.kudelskisecurity.com/2021/08/12/the-poly-network-hack-explained/",
    "https://blog.chainalysis.com/reports/poly-network-hack-august-2021/"
  ],
  "tags": [
    "cross_chain",
    "access_control",
    "privilege_escalation",
    "proxy_bypass",
    "historical",
    "mega_hack"
  ],
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_007",
  "notes": "One of the largest crypto hacks ever ($611M). Uniquely, the attacker returned most funds, suggesting white hat intentions or demonstrating vulnerability for recognition. Attacker communicated via embedded transaction messages. Classic access control bypass via proxy pattern. Demonstrates importance of restricting execution targets in proxy/manager contracts. Affected multiple chains (Ethereum, BSC, Polygon).",
  "contract_file": "contracts/ss_tc_007.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_007.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_007.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 28 identifiers using hex style",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "getCurEpochConPubKeyBytes": "_0x390062",
      "putCurEpochConPubKeyBytes": "_0x0cce35",
      "verifyHeaderAndExecuteTx": "_0x8cd0a4",
      "currentEpochPublicKeys": "_0x7d6277",
      "encodeWithSignature": "_0x7248ad",
      "transferOwnership": "_0x477183",
      "curEpochPkBytes": "_0x347a3f",
      "previousOwner": "_0x2c833f",
      "_dataContract": "_0xd80623",
      "_verifyHeader": "_0x1045d1",
      "_verifyProof": "_0x0f4194",
      "curRawHeader": "_0x2ff8d2",
      "dataContract": "_0x6ff151",
      "encodePacked": "_0x771f54",
      "fromContract": "_0x0d961f",
      "headerProof": "_0x65ce0c",
      "toContract": "_0xd6cb4d",
      "rawHeader": "_0x70dd97",
      "onlyOwner": "_0xe5feba",
      "headerSig": "_0x8e6f03",
      "_decodeTx": "_0x0353ce",
      "newOwner": "_0x51bedd",
      "success": "_0xd860ea",
      "newKeys": "_0xae3550",
      "method": "_0x8e4527",
      "owner": "_0x4f9b02",
      "proof": "_0x6e3d9a",
      "args": "_0xac561e"
    },
    "coverage_percent": 73.68,
    "identifiers_transformed": 28,
    "created_date": "2025-12-31T19:59:41.145081"
  },
  "sanitized_from": "ms_tc_007"
}