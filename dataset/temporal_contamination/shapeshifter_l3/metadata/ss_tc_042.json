{
  "sample_id": "ss_tc_042",
  "exploit_name": "Hedgey Finance",
  "timestamp": "2024-04",
  "loss_amount_usd": 44700000,
  "blockchain": "ethereum",
  "vulnerability_type": "access_control",
  "sub_category": "arbitrary_external_call",
  "severity": "critical",
  "tags": [
    "token_locker",
    "arbitrary_call",
    "approval_exploit",
    "donation",
    "user_input_validation"
  ],
  "difficulty": "advanced",
  "temporal_category": "pre_cutoff",
  "cutoff_date": "2024-04",
  "description": "Hedgey Finance, a token vesting platform, was exploited for $44.7M when attackers provided a malicious tokenLocker address in createLockedCampaign(). The contract made an arbitrary external call to this address, allowing attackers to steal tokens from any user who had approved Hedgey.",
  "vulnerable_lines": [
    51
  ],
  "vulnerability_details": {
    "root_cause": "User-controlled tokenLocker address used in arbitrary external call without validation",
    "attack_vector": "Provide malicious contract as tokenLocker, use external call to invoke transferFrom on victim tokens",
    "vulnerable_functions": [
      "_0x390062()"
    ],
    "key_weakness": [
      "User-controlled address in external call",
      "No whitelist of approved tokenLocker contracts",
      "Arbitrary external call without validation",
      "Users gave unlimited approvals",
      "No contract code verification",
      "Missing access controls on campaign creation"
    ]
  },
  "attack_flow": [
    "Create malicious tokenLocker contract implementing createTokenLock()",
    "Malicious contract calls transferFrom() on victims instead of locking",
    "Identify victims with USDC approvals to Hedgey",
    "Obtain 1.305M USDC flashloan from Balancer",
    "Call createLockedCampaign() with malicious tokenLocker address",
    "Hedgey calls attackerContract.createTokenLock()",
    "Malicious contract executes: USDC.transferFrom(victim, attacker, balance)",
    "Transfer succeeds because victim approved Hedgey contract",
    "Repeat for multiple victims across various tokens",
    "Drain total of $44.7M from approved users",
    "Repay flashloan and keep stolen funds"
  ],
  "mitigation": [
    "Whitelist approved tokenLocker contract addresses",
    "Never make external calls to user-provided addresses",
    "Implement contract code verification before allowing",
    "Use proxy pattern with upgradeable approved lockers",
    "Implement approval scoping (Permit2 pattern)",
    "Add maximum approval amounts",
    "Monitor for unusual transferFrom patterns",
    "Add pause mechanism for suspicious activity"
  ],
  "references": [
    "https://medium.com/@CUBE3AI/hedgey-finance-hack-detected-by-cube3-ai-minutes-before-exploit-1f500e7052d4",
    "https://twitter.com/Cube3AI/status/1781294512716820918",
    "https://etherscan.io/address/0xBc452fdC8F851d7c5B72e1Fe74DFB63bb793D511"
  ],
  "contract_file": "contracts/ss_tc_042.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_042",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_042.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_042.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 28 identifiers using hex style",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "createLockedCampaign": "_0x390062",
      "encodeWithSignature": "_0x0cce35",
      "cancelCampaign": "_0x8cd0a4",
      "transferFrom": "_0x7d6277",
      "claimLockup": "_0x7248ad",
      "tokenLockup": "_0x477183",
      "tokenLocker": "_0x347a3f",
      "campaignId": "_0x2c833f",
      "balanceOf": "_0xd80623",
      "campaigns": "_0x1045d1",
      "donation": "_0x0f4194",
      "campaign": "_0x2ff8d2",
      "manager": "_0x6ff151",
      "account": "_0x771f54",
      "approve": "_0x0d961f",
      "periods": "_0x65ce0c",
      "spender": "_0xd6cb4d",
      "success": "_0x70dd97",
      "amount": "_0xe5feba",
      "period": "_0x8e6f03",
      "token": "_0x0353ce",
      "cliff": "_0x51bedd",
      "start": "_0xd860ea",
      "rate": "_0xae3550",
      "root": "_0x8e4527",
      "end": "_0x4f9b02",
      "to": "_0x6e3d9a",
      "id": "_0xac561e"
    },
    "coverage_percent": 73.68,
    "identifiers_transformed": 28,
    "created_date": "2025-12-31T19:59:41.237850"
  },
  "vulnerable_contract": "TokenClaimCampaigns",
  "vulnerable_function": "_0x390062",
  "sanitized_from": "ms_tc_042"
}