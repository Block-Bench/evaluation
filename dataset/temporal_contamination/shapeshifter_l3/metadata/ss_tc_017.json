{
  "id": "pickle_finance_2020",
  "exploit_name": "Pickle Finance",
  "date": "2020-11-21",
  "blockchain": "ethereum",
  "amount_stolen_usd": "20000000",
  "amount_stolen_crypto": "~20M DAI",
  "vulnerability_type": "access_control",
  "attack_type": "arbitrary_call_exploit",
  "difficulty": 4,
  "impact": "critical",
  "description": "Arbitrary external call vulnerability in controller's swap function. The swapExactJarForJar function accepted user-provided target addresses and calldata, making unchecked external calls that drained strategy funds.",
  "root_cause": "Controller allowed arbitrary external calls with user-provided targets and data without validation. Strategy functions like withdrawAll() lacked access control checks, allowing controller to call them on behalf of attacker.",
  "attack_scenario": "Attacker created fake jar contracts, called swapExactJarForJar with malicious targets pointing to real strategies and calldata encoding withdrawAll(). Controller executed these calls, draining strategies.",
  "vulnerable_contract": "YieldController",
  "vulnerable_function": "_0x390062",
  "vulnerable_lines": [
    30
  ],
  "fix_description": "Remove arbitrary call functionality. Implement specific swap logic directly. Add access control to all strategy functions (require msg.sender == controller). If arbitrary calls needed, use strict whitelisting of targets and function selectors.",
  "tags": [
    "arbitrary-call",
    "access-control",
    "missing-authorization",
    "privilege-escalation"
  ],
  "references": [
    "https://etherscan.io/tx/0xe72d4e7ba9b5af0cf2a8cfb1e30fd9f388df0ab3da79790be842bfbed11087b0",
    "https://github.com/banteg/evil-jar"
  ],
  "historical_significance": "Major DeFi hack demonstrating danger of arbitrary external calls. Led to widespread removal of generic call functionality in protocols. Established pattern of strict function whitelisting.",
  "compiler_version": "0.8.0",
  "is_pre_cutoff": true,
  "cutoff_date": "2024-01-01",
  "contract_file": "contracts/ss_tc_017.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "ss_tc_017",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_017",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_017.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_017.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 24 identifiers using hex style",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "swapExactJarForJar": "_0x390062",
      "_toJarMinAmount": "_0x0cce35",
      "_fromJarAmount": "_0x8cd0a4",
      "withdrawAll": "_0x7d6277",
      "setStrategy": "_0x7248ad",
      "_controller": "_0x477183",
      "strategies": "_0x347a3f",
      "controller": "_0x2c833f",
      "governance": "_0xd80623",
      "balanceOf": "_0x1045d1",
      "_targets": "_0x0f4194",
      "strategy": "_0x2ff8d2",
      "withdraw": "_0x6ff151",
      "_fromJar": "_0x771f54",
      "account": "_0x0d961f",
      "success": "_0x65ce0c",
      "amount": "_0xd6cb4d",
      "_toJar": "_0x70dd97",
      "token": "_0xe5feba",
      "_want": "_0x8e6f03",
      "_data": "_0x0353ce",
      "want": "_0x51bedd",
      "jar": "_0xd860ea",
      "to": "_0xae3550"
    },
    "coverage_percent": 70.59,
    "identifiers_transformed": 24,
    "created_date": "2025-12-31T19:59:41.172237"
  },
  "sanitized_from": "ms_tc_017"
}