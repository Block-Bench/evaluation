{
  "id": "yearn_ydai_2021",
  "exploit_name": "Yearn Finance yDAI Vault",
  "date": "2021-02-04",
  "blockchain": "ethereum",
  "amount_stolen_usd": "11000000",
  "amount_stolen_crypto": "Various stablecoins",
  "vulnerability_type": "price_oracle_manipulation",
  "attack_type": "flash_loan_pool_manipulation",
  "difficulty": 4,
  "impact": "high",
  "description": "Flash loan attack manipulating Curve pool to inflate virtual_price. The earn function trusted Curve's spot price which was temporarily inflated through imbalanced liquidity, causing vault to overvalue its position.",
  "root_cause": "Using manipulable spot price from Curve pool (get_virtual_price) for vault strategy calculations. Spot prices can be manipulated within single transaction via flash loans that temporarily imbalance AMM pools.",
  "attack_scenario": "Attacker used flash loans to imbalance Curve 3pool, inflating virtual_price. Called vault.earn() which used inflated price. Normalized pool, repeated process multiple times to siphon value. Withdrew with inflated shares.",
  "vulnerable_contract": "YieldVault",
  "vulnerable_function": "_0x6e3d9a",
  "vulnerable_lines": [
    54,
    71
  ],
  "fix_description": "Use TWAP oracle instead of spot price. Implement slippage protection on Curve operations. Add sanity checks comparing spot price to time-weighted average. Limit strategy execution frequency.",
  "tags": [
    "flash-loan",
    "oracle-manipulation",
    "stable-pool",
    "amm-manipulation",
    "spot-price",
    "vault-strategy"
  ],
  "references": [
    "https://github.com/yearn/yearn-security/blob/master/disclosures/2021-02-04.md",
    "https://etherscan.io/tx/0x59faab5a1911618064f1ffa1e4649d85c99cfd9f0d64dcebbc1af7d7630da98b"
  ],
  "historical_significance": "Major Yearn exploit demonstrating flash loan price manipulation. Led to widespread adoption of TWAP oracles in DeFi. Showed danger of trusting AMM spot prices.",
  "compiler_version": "0.8.0",
  "is_pre_cutoff": true,
  "cutoff_date": "2024-01-01",
  "contract_file": "contracts/ss_tc_014.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "ss_tc_014",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_014",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_014.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_014.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 30 identifiers using hex style",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "remove_liquidity_imbalance": "_0x390062",
      "get_virtual_price": "_0x0cce35",
      "min_mint_amount": "_0x8cd0a4",
      "max_burn_amount": "_0x7d6277",
      "withdrawAmount": "_0x7248ad",
      "add_liquidity": "_0x477183",
      "totalDeposits": "_0x347a3f",
      "_stable3Pool": "_0x2c833f",
      "transferFrom": "_0xd80623",
      "virtualPrice": "_0x1045d1",
      "vaultBalance": "_0x0f4194",
      "withdrawAll": "_0x2ff8d2",
      "stable3Pool": "_0x6ff151",
      "shareAmount": "_0x771f54",
      "totalShares": "_0x0d961f",
      "userShares": "_0x65ce0c",
      "balanceOf": "_0xd6cb4d",
      "account": "_0x70dd97",
      "approve": "_0xe5feba",
      "deposit": "_0x8e6f03",
      "spender": "_0x0353ce",
      "amounts": "_0x51bedd",
      "amount": "_0xd860ea",
      "shares": "_0xae3550",
      "_crv3": "_0x8e4527",
      "_dai": "_0x4f9b02",
      "earn": "_0x6e3d9a",
      "crv3": "_0xac561e",
      "dai": "_0x3454e7",
      "to": "_0x2f7c62"
    },
    "coverage_percent": 75.0,
    "identifiers_transformed": 30,
    "created_date": "2025-12-31T19:59:41.165739"
  },
  "sanitized_from": "ms_tc_014"
}