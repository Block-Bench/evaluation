{
  "sample_id": "ss_tc_029",
  "exploit_name": "Radiant Capital Rounding Exploit",
  "timestamp": "2024-01",
  "loss_amount_usd": 4500000,
  "blockchain": "arbitrum",
  "vulnerability_type": "arithmetic_manipulation",
  "sub_category": "rounding_error",
  "severity": "high",
  "tags": [
    "flashloan",
    "rounding_error",
    "time_manipulation",
    "aave_fork",
    "liquidity_index",
    "fixed_point_arithmetic"
  ],
  "difficulty": "expert",
  "temporal_category": "pre_cutoff",
  "cutoff_date": "2024-01",
  "description": "Radiant Capital (Aave V2 fork on Arbitrum) was exploited for $4.5M through manipulation of the liquidityIndex via repeated flashloan cycles. The attacker executed 151 nested flashloans to inflate the liquidityIndex to extreme values, causing rounding errors in the rayDiv function that allowed extracting more funds than deposited.",
  "vulnerable_lines": [
    41,
    103
  ],
  "vulnerability_details": {
    "root_cause": "Unbounded liquidityIndex growth combined with fixed-point arithmetic rounding errors",
    "attack_vector": "Repeated flashloan deposit/withdrawal cycles to manipulate liquidityIndex, then exploit rounding in withdrawal calculations",
    "vulnerable_functions": [
      "_0xd6cb4d()",
      "_0xae3550()",
      "_0x8e6f03()",
      "_0xac561e()"
    ],
    "key_weakness": [
      "No flashloan recursion limits",
      "Unbounded liquidityIndex growth",
      "Significant rounding errors at extreme values",
      "Missing manipulation detection",
      "No rate limiting on deposit/withdrawal cycles",
      "Inadequate bounds checking"
    ]
  },
  "attack_flow": [
    "Borrow 3M USDC from Aave V3 via flashloan",
    "Deposit 2M USDC into Radiant pool, receive rUSDC tokens",
    "Execute 151 nested Radiant flashloans (2M USDC each)",
    "In each flashloan callback: deposit borrowed USDC, then immediately withdraw",
    "Each cycle slightly increases liquidityIndex due to interest calculations",
    "After 151 iterations, liquidityIndex reaches astronomical value",
    "Transfer rUSDC to helper contract",
    "Withdraw USDC: rayDiv rounding errors return more USDC than deserved",
    "Borrow WETH against manipulated collateral",
    "Swap tokens and profit $4.5M"
  ],
  "mitigation": [
    "Implement reentrancy guards on flashloan functions",
    "Add maximum recursion depth limits for flashloans",
    "Implement bounds checking on liquidityIndex values",
    "Use higher precision arithmetic for large index values",
    "Monitor for rapid liquidityIndex changes",
    "Add time delays between deposit and withdrawal",
    "Implement circuit breakers for unusual activity",
    "Consider using fixed liquidityIndex update intervals"
  ],
  "references": [
    "https://neptunemutual.com/blog/how-was-radiant-capital-exploited/",
    "https://twitter.com/BeosinAlert/status/1742389285926678784",
    "https://arbiscan.io/address/0xf4b1486dd74d07706052a33d31d7c0aafd0659e1"
  ],
  "contract_file": "contracts/ss_tc_029.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_029",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_029.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_029.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 36 identifiers using hex style",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "currentLiquidityIndex": "_0x390062",
      "executeOperation": "_0x0cce35",
      "interestRateMode": "_0x8cd0a4",
      "receiverAddress": "_0x7d6277",
      "totalLiquidity": "_0x7248ad",
      "liquidityIndex": "_0x477183",
      "rTokensToBurn": "_0x347a3f",
      "rTokenAddress": "_0x2c833f",
      "referralCode": "_0xd80623",
      "transferFrom": "_0x1045d1",
      "rTokenAmount": "_0x0f4194",
      "_burnRToken": "_0x2ff8d2",
      "_mintRToken": "_0x6ff151",
      "onBehalfOf": "_0x771f54",
      "initiator": "_0x0d961f",
      "balanceOf": "_0x65ce0c",
      "flashLoan": "_0xd6cb4d",
      "premiums": "_0x70dd97",
      "reserves": "_0xe5feba",
      "withdraw": "_0x8e6f03",
      "account": "_0x0353ce",
      "approve": "_0x51bedd",
      "reserve": "_0xd860ea",
      "deposit": "_0xae3550",
      "spender": "_0x8e4527",
      "amounts": "_0x4f9b02",
      "amount": "_0x6e3d9a",
      "rayDiv": "_0xac561e",
      "assets": "_0x3454e7",
      "borrow": "_0x2f7c62",
      "params": "_0xc285d4",
      "rToken": "_0x3184cf",
      "halfB": "_0xb7cc25",
      "modes": "_0xb01af6",
      "asset": "_0x876f47",
      "to": "_0x163f22"
    },
    "coverage_percent": 78.26,
    "identifiers_transformed": 36,
    "created_date": "2025-12-31T19:59:41.208160"
  },
  "vulnerable_contract": "CrossLendingPool",
  "vulnerable_function": "_0xd6cb4d",
  "sanitized_from": "ms_tc_029",
  "is_vulnerable": true
}