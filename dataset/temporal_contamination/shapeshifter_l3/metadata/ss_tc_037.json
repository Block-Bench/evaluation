{
  "sample_id": "ss_tc_037",
  "exploit_name": "Bedrock DeFi Exchange Rate Exploit",
  "timestamp": "2024-09",
  "loss_amount_usd": 2000000,
  "blockchain": "ethereum",
  "vulnerability_type": "logic_error",
  "sub_category": "exchange_rate_miscalculation",
  "severity": "critical",
  "tags": [
    "liquid_staking",
    "btc",
    "exchange_rate",
    "price_oracle",
    "mint_redeem",
    "flashloan",
    "hardcoded_rate"
  ],
  "difficulty": "intermediate",
  "temporal_category": "pre_cutoff",
  "cutoff_date": "2024-09",
  "description": "Bedrock DeFi, a liquid staking platform for uniBTC, was exploited for $2M due to an incorrect hardcoded 1:1 ETH:BTC exchange rate in its mint function. Attackers deposited ETH and received uniBTC at par value, despite ETH being worth ~20x less than BTC, then swapped for profit.",
  "vulnerable_lines": [
    40,
    54
  ],
  "vulnerability_details": {
    "root_cause": "Hardcoded 1:1 ETH:BTC exchange rate ignoring actual market prices (~20x difference)",
    "attack_vector": "Mint uniBTC by depositing ETH at incorrect 1:1 rate, swap uniBTC for real BTC-pegged assets at market rate",
    "vulnerable_functions": [
      "_0xac561e()",
      "_0xd860ea()",
      "_0x477183()"
    ],
    "key_weakness": [
      "Hardcoded 1:1 ETH:BTC exchange rate",
      "No price oracle integration",
      "Missing exchange rate validation",
      "No consideration of actual asset values",
      "Lack of market price checks",
      "No slippage protection",
      "Missing liquidity depth checks"
    ]
  },
  "attack_flow": [
    "Obtain 30,800 ETH flashloan from Balancer (~$92M)",
    "Call mint() depositing 30,800 ETH",
    "Contract incorrectly assumes 1 ETH = 1 BTC",
    "Receive 30,800 uniBTC tokens (real value: ~$2B)",
    "Swap uniBTC for WBTC on Uniswap V3 pool",
    "Due to liquidity limits, receive ~30 WBTC (~$2M)",
    "Swap WBTC back to ETH via Uniswap",
    "Repay 30,800 ETH flashloan to Balancer",
    "Keep net profit: ~$1.7-2M"
  ],
  "mitigation": [
    "Integrate Chainlink price feeds for ETH/BTC ratio",
    "Calculate proper exchange rate: (ethAmount * ethPrice) / btcPrice",
    "Add minimum/maximum exchange rate bounds",
    "Implement slippage protection for mints/redeems",
    "Add circuit breakers for unusual exchange rates",
    "Require multiple oracle sources for validation",
    "Add time-weighted price checks",
    "Implement mint/redeem fees to discourage arbitrage",
    "Add liquidity depth checks before large mints",
    "Implement emergency pause functionality"
  ],
  "references": [
    "https://twitter.com/rotcivegaf",
    "https://etherscan.io/address/0x047D41F2544B7F63A8e991aF2068a363d210d6Da"
  ],
  "contract_file": "contracts/ss_tc_037.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_037",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_037.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_037.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 30 identifiers using hex style",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "sqrtPriceLimitX96": "_0x390062",
      "totalUniBTCMinted": "_0x0cce35",
      "totalETHDeposited": "_0x8cd0a4",
      "exactInputSingle": "_0x7d6277",
      "amountOutMinimum": "_0x7248ad",
      "getExchangeRate": "_0x477183",
      "uniBTCAmount": "_0x347a3f",
      "transferFrom": "_0x2c833f",
      "ethAmount": "_0xd80623",
      "recipient": "_0x1045d1",
      "balanceOf": "_0x0f4194",
      "amountOut": "_0x2ff8d2",
      "tokenOut": "_0x6ff151",
      "amountIn": "_0x771f54",
      "deadline": "_0x0d961f",
      "tokenIn": "_0x65ce0c",
      "account": "_0xd6cb4d",
      "spender": "_0x70dd97",
      "_router": "_0xe5feba",
      "_uniBTC": "_0x8e6f03",
      "approve": "_0x0353ce",
      "router": "_0x51bedd",
      "redeem": "_0xd860ea",
      "uniBTC": "_0xae3550",
      "amount": "_0x8e4527",
      "params": "_0x4f9b02",
      "_wbtc": "_0x6e3d9a",
      "mint": "_0xac561e",
      "fee": "_0x3454e7",
      "to": "_0x2f7c62"
    },
    "coverage_percent": 75.0,
    "identifiers_transformed": 30,
    "created_date": "2025-12-31T20:00:45.650438"
  },
  "vulnerable_contract": "StakingVault",
  "vulnerable_function": "_0xac561e",
  "sanitized_from": "ms_tc_037",
  "is_vulnerable": true
}