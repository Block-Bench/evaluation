{
  "sample_id": "ss_tc_031",
  "exploit_name": "Gamma Strategies Hypervisor",
  "timestamp": "2024-01",
  "loss_amount_usd": 6100000,
  "blockchain": "arbitrum",
  "vulnerability_type": "price_manipulation",
  "sub_category": "liquidity_management",
  "severity": "high",
  "tags": [
    "defi",
    "price_manipulation",
    "flashloan",
    "liquidity_vault",
    "slippage",
    "uniswap_v3",
    "sandwich_attack"
  ],
  "difficulty": "expert",
  "temporal_category": "pre_cutoff",
  "cutoff_date": "2024-01",
  "description": "Gamma Strategies managed liquidity positions on Uniswap V3/Algebra pools. Attackers used flashloans to manipulate pool prices, then exploited the vault's deposit/withdrawal and rebalancing mechanisms during price manipulation to extract $6.1M.",
  "vulnerable_lines": [
    54
  ],
  "vulnerability_details": {
    "root_cause": "Lack of slippage protection and oracle usage in deposit/withdrawal share calculations",
    "attack_vector": "Flashloan price manipulation combined with vault interaction during manipulated state",
    "vulnerable_functions": [
      "_0x8e4527()",
      "_0x8e6f03()",
      "_0x2ff8d2()"
    ],
    "key_weakness": [
      "No TWAP or external oracle for price validation",
      "Share calculation based on manipulable spot price",
      "No slippage limits on deposits/withdrawals",
      "Rebalancing can occur during price manipulation",
      "Missing deposit/withdrawal cooldown periods",
      "No maximum transaction size limits"
    ]
  },
  "attack_flow": [
    "Obtain large flashloans: 3000 USDT from Uniswap V3, 2000 USDCe from Balancer",
    "Execute 15 iterations of large swaps through Algebra pool to manipulate price",
    "During manipulated price state, interact with Gamma Hypervisor",
    "Deposit tokens at manipulated price, receive inflated share amounts",
    "Trigger vault rebalance operations during manipulation to lock in bad state",
    "Perform reverse swaps to restore pool price to normal",
    "Withdraw from Gamma at corrected price with inflated shares",
    "Profit from share valuation discrepancy: $6.1M",
    "Repay flashloans and extract profit in ETH"
  ],
  "mitigation": [
    "Implement TWAP oracles for price validation",
    "Use Chainlink or other external price oracles",
    "Add slippage limits on all deposits/withdrawals",
    "Require balanced deposits according to true pool ratio",
    "Add cooldown periods between deposits and withdrawals",
    "Implement maximum deposit/withdrawal per block limits",
    "Add circuit breakers for large price movements",
    "Implement deposit/withdrawal fees to increase attack cost",
    "Add time-weighted checks before rebalancing",
    "Monitor for sandwich attack patterns"
  ],
  "references": [
    "https://twitter.com/officer_cia/status/1742772207997050899",
    "https://twitter.com/shoucccc/status/1742765618984829326",
    "https://arbiscan.io/address/0x1F1Ca4e8236CD13032653391dB7e9544a6ad123E"
  ],
  "contract_file": "contracts/ss_tc_031.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_031",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_031.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_031.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 36 identifiers using hex style",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "sqrtPriceLimitX96": "_0x390062",
      "_removeLiquidity": "_0x0cce35",
      "amountSpecified": "_0x8cd0a4",
      "amount1Current": "_0x7d6277",
      "amount0Current": "_0x7248ad",
      "limitPosition": "_0x477183",
      "_addLiquidity": "_0x347a3f",
      "transferFrom": "_0x2c833f",
      "basePosition": "_0xd80623",
      "totalSupply": "_0x1045d1",
      "zeroForOne": "_0x0f4194",
      "rebalance": "_0x2ff8d2",
      "recipient": "_0x6ff151",
      "tickUpper": "_0x771f54",
      "balanceOf": "_0x0d961f",
      "tickLower": "_0x65ce0c",
      "liquidity": "_0xd6cb4d",
      "deposit0": "_0x70dd97",
      "deposit1": "_0xe5feba",
      "withdraw": "_0x8e6f03",
      "amount0": "_0x0353ce",
      "account": "_0x51bedd",
      "approve": "_0xd860ea",
      "amount1": "_0xae3550",
      "deposit": "_0x8e4527",
      "spender": "_0x4f9b02",
      "amount": "_0x6e3d9a",
      "token1": "_0xac561e",
      "shares": "_0x3454e7",
      "token0": "_0x2f7c62",
      "total1": "_0xc285d4",
      "total0": "_0x3184cf",
      "flash": "_0xb7cc25",
      "swap": "_0xb01af6",
      "pool": "_0x876f47",
      "to": "_0x163f22"
    },
    "coverage_percent": 78.26,
    "identifiers_transformed": 36,
    "created_date": "2025-12-31T19:59:41.213383"
  },
  "vulnerable_contract": "LiquidityHypervisor",
  "vulnerable_function": "_0x8e4527",
  "sanitized_from": "ms_tc_031",
  "is_vulnerable": true
}