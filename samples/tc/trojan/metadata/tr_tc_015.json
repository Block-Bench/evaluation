{
  "sample_id": "tr_tc_015",
  "exploit_name": "Indexed Finance Pool Manipulation",
  "date": "2021-10-14",
  "amount_lost_usd": "16000000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "pool_manipulation",
  "vulnerability_subtype": "",
  "severity": "",
  "difficulty_tier": 0,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Attacker exploited Indexed Finance's pool weight recalculation mechanism. By using flash loans to massively drain liquidity of a single token, the attacker caused the pool's internal weight calculation to become extremely skewed. The vulnerability was that token weights were updated based on instantaneous balances after each swap, rather than using time-weighted averages or external oracles.",
  "vulnerable_contract": "TokenPool",
  "vulnerable_function": "_updateWeights",
  "vulnerable_lines": [
    56,
    101
  ],
  "attack_scenario": "1) Flash loan large amounts of SUSHI, UNI, and other index tokens. 2) Execute massive swaps to drain almost all of a target token (DEFI5) from the pool. 3) Pool's _updateWeights() function recalculates weights based on the new unbalanced state. 4) Target token now has extremely low weight (~1%), making it undervalued. 5) Buy back the drained token at manipulated low prices. 6) Repay flash loans and profit from price discrepancy. Loss: $16M.",
  "root_cause": "Token weights in index pools were recalculated based on instantaneous token balances after swaps. Flash loan attackers could temporarily drain liquidity of a single token, causing weight recalculation to heavily undervalue that token, then buy it back at manipulated prices.",
  "fix_description": "",
  "source_reference": "",
  "external_references": [],
  "tags": [
    "flash_loan",
    "pool_manipulation",
    "weight_manipulation",
    "defi",
    "index_funds",
    "oracle_free_pricing",
    "trojan"
  ],
  "variant_type": "trojan",
  "variant_parent_id": "tc_015",
  "notes": "",
  "contract_file": "contracts/tr_tc_015.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "trojan",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/contracts/tc_018.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/metadata/tc_018.json",
    "script": "manual",
    "changes": [
      "Removed vulnerability documentation and comments",
      "Added distractor code (fake security metrics, config tracking)",
      "Added suspicious-named variables as red herrings",
      "Preserved original vulnerability",
      "Renamed contracts to generic names"
    ],
    "distractors": {
      "config_variables": 2,
      "score_variables": 15,
      "activity_variables": 0,
      "fake_functions": 2,
      "view_helpers": 1,
      "suspicious_names": 15
    },
    "contracts_renamed": [
      "TokenPool"
    ],
    "vulnerability_preserved": true,
    "documentation_removed": true,
    "created_date": "2025-12-30T01:40:33.657763",
    "sanitized": true,
    "sanitization_date": "2026-01-02T02:10:09.728746",
    "code_renames": {}
  }
}