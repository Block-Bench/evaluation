{
  "sample_id": "tr_tc_019",
  "exploit_name": "Uranium Finance AMM Miscalculation",
  "date": "2021-04-28",
  "amount_lost_usd": "50000000",
  "blockchain": "binance_smart_chain",
  "language": "solidity",
  "vulnerability_type": "arithmetic_error",
  "vulnerability_subtype": "",
  "severity": "",
  "difficulty_tier": 0,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Uranium Finance forked Uniswap V2 and changed the swap fee from 0.3% to 0.16%, updating the fee calculation denominator from 1000 to 10000. However, they failed to update the constant product (K) validation check to use the same scale. The adjusted balances used scale 10000, but the K check compared against reserves * 1000^2, creating a 100x mismatch that allowed K to inflate after each swap.",
  "vulnerable_contract": "TokenPair",
  "vulnerable_function": "swap",
  "vulnerable_lines": [
    100
  ],
  "attack_scenario": "1) Attacker deposited tokens into Uranium WBNB/BUSD pool. 2) Executed swap with amount0In. 3) K validation: left side (balance * 10000) vs right side (reserve * 1000^2) created 100x discrepancy. 4) Check passed even though K actually increased 100x. 5) Swapped back in opposite direction with even more inflated K. 6) Each swap cycle further inflated the constant product. 7) After 5-10 iterations, attacker drained $50M by extracting more tokens than deposited. Pool became completely imbalanced.",
  "root_cause": "When changing the fee from 0.3% to 0.16%, developers updated the fee calculation to use denominator 10000 instead of 1000. However, the constant product invariant check still used the old 1000 scale (reserve0 * reserve1 * 1000^2) instead of the new scale (reserve0 * reserve1 * 10000^2). This created a 100x mismatch allowing K to inflate after swaps.",
  "fix_description": "",
  "source_reference": "",
  "external_references": [],
  "tags": [
    "amm",
    "uniswap_fork",
    "constant_product",
    "calculation_error",
    "bsc",
    "precision_mismatch",
    "trojan"
  ],
  "variant_type": "trojan",
  "variant_parent_id": "tc_019",
  "notes": "",
  "contract_file": "contracts/tr_tc_019.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "trojan",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/contracts/tc_022.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/metadata/tc_022.json",
    "script": "manual",
    "changes": [
      "Removed vulnerability documentation and comments",
      "Added distractor code (fake security metrics, config tracking)",
      "Added suspicious-named variables as red herrings",
      "Preserved original vulnerability",
      "Renamed contracts to generic names"
    ],
    "distractors": {
      "config_variables": 2,
      "score_variables": 14,
      "activity_variables": 0,
      "fake_functions": 2,
      "view_helpers": 1,
      "suspicious_names": 15
    },
    "contracts_renamed": [
      "TokenPair"
    ],
    "vulnerability_preserved": true,
    "documentation_removed": true,
    "created_date": "2025-12-30T01:40:33.661330",
    "sanitized": true,
    "sanitization_date": "2026-01-02T02:10:09.771368",
    "code_renames": {}
  }
}