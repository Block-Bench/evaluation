{
  "is_vulnerable": true,
  "vulnerability_type": "access_control",
  "vulnerable_functions": [
    "uniswapV3SwapCallback"
  ],
  "severity": "high",
  "description": "CoW Protocol's solver contract was exploited for $166K when an attacker directly called the uniswapV3SwapCallback function with crafted parameters. The callback lacked msg.sender validation, allowing anyone to invoke it and extract funds without performing a legitimate swap.",
  "root_cause": "Missing msg.sender validation in Uniswap V3 callback function, allowing direct external calls\n\nKey Weaknesses: No validation that msg.sender is legitimate Uniswap pool; Callback marked as external/public instead of internal; Trusts user-provided addresses in callback data",
  "attack_scenario": "Directly call uniswapV3SwapCallback with malicious parameters, bypassing swap validation to extract funds\n\nAttack Flow: Identify CowSolver contract with exposed uniswapV3SwapCallback \u2192 Craft malicious callback parameters: negative amount0Delta, positive amount1Delta \u2192 Encode attacker-controlled addresses in data parameter \u2192 Directly call uniswapV3SwapCallback() on solver contract \u2192 Contract has no msg.sender validation, processes call \u2192 Callback trusts attacker-provided parameters \u2192 Contract calculates payment based on manipulated amounts \u2192 Withdraws WETH and sends to attacker-specified recipient \u2192 Attacker receives ~5.37 WETH (~$166K) \u2192 No repayment required since direct call bypassed pool validation",
  "fix_description": "Validate msg.sender is legitimate Uniswap V3 pool; Maintain whitelist of approved pool addresses; Use Uniswap factory.getPool() to verify pool legitimacy",
  "language": "solidity",
  "vulnerable_lines": [
    35
  ],
  "sub_category": "unauthorized_callback"
}