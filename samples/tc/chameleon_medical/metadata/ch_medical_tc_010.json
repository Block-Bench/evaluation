{
  "id": "rari_capital_2022",
  "exploit_name": "Rari Capital Fuse",
  "date": "2022-05-08",
  "blockchain": "ethereum",
  "amount_stolen_usd": "80000000",
  "amount_stolen_crypto": "Various",
  "vulnerability_type": "reentrancy",
  "attack_type": "cross_function_reentrancy",
  "difficulty": 4,
  "impact": "critical",
  "is_vulnerable": true,
  "description": "Cross-function reentrancy attack. The borrow function sent ETH before final health check, allowing attacker to call exitMarket during callback and bypass collateral requirements.",
  "root_cause": "Cross-function reentrancy. Borrow sent ETH (triggering callback) before final validation. Attacker called exitMarket during callback, modifying shared state (inMarket) and bypassing health checks.",
  "attack_scenario": "Attacker deposited collateral and entered market, called borrow to get ETH. During ETH transfer callback, attacker called exitMarket to remove collateral requirement. Final health check used stale state, allowing over-borrowing.",
  "vulnerable_contract": "LendingHub",
  "vulnerable_function": "requestAdvance",
  "vulnerable_lines": [
    63,
    66,
    71
  ],
  "fix_description": "Use global ReentrancyGuard on all functions that share state. Perform all validations after external calls. Prevent exitMarket when positions are open. Consider mutex locks for cross-function protection.",
  "tags": [
    "reentrancy",
    "cross-function",
    "oracle-manipulation",
    "health-check"
  ],
  "references": [
    "https://www.blocksecteam.com/blog/2022/05/rari-capital-fuse-pool-hack/",
    "https://twitter.com/FeiProtocol/status/1520847142650499072"
  ],
  "historical_significance": "Demonstrated sophisticated cross-function reentrancy. Shows that per-function reentrancy guards aren't sufficient when multiple functions share state.",
  "compiler_version": "0.8.0",
  "is_pre_cutoff": true,
  "cutoff_date": "2024-01-01",
  "contract_file": "contracts/ch_medical_tc_010.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "ch_medical_tc_010",
  "variant_type": "chameleon_medical",
  "variant_parent_id": "nc_tc_010",
  "transformation": {
    "type": "chameleon",
    "theme": "medical",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_010.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_010.json",
    "script": "strategies/chameleon/chameleon_tc.py",
    "changes": [
      "Applied medical theme transformation",
      "Renamed 28/68 identifiers (41.2% coverage)"
    ],
    "rename_map": {
      "enterMarkets": "registerMarkets",
      "cTokens": "cCredentials",
      "exitMarket": "checkoutMarket",
      "cToken": "cCredential",
      "getAccountLiquidity": "acquireProfileAvailableresources",
      "account": "profile",
      "deposits": "payments",
      "borrowed": "advancedAmount",
      "totalDeposits": "totalamountPayments",
      "totalBorrowed": "totalamountAdvancedamount",
      "COLLATERAL_FACTOR": "securitydeposit_factor",
      "depositAndEnterMarket": "submitpaymentAndCheckinMarket",
      "sender": "requestor",
      "value": "measurement",
      "isHealthy": "validateHealthy",
      "additionalBorrow": "additionalRequestadvance",
      "totalDebt": "totalamountOutstandingbalance",
      "collateralValue": "securitydepositMeasurement",
      "borrow": "requestAdvance",
      "amount": "quantity",
      "collateral": "securityDeposit",
      "success": "recovery",
      "check": "inspectStatus",
      "debt": "outstandingBalance",
      "withdraw": "dischargeFunds",
      "Exit": "Checkout",
      "market": "serviceMarket",
      "first": "initial"
    },
    "coverage_percent": 41.18,
    "identifiers_transformed": 28,
    "identifiers_total": 68,
    "created_date": "2025-12-31T19:50:53.766848"
  },
  "sanitized_from": "ms_tc_010"
}
