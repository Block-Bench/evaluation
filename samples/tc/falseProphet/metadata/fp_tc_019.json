{
  "sample_id": "fp_tc_019",
  "exploit_name": "Uranium Finance AMM Miscalculation",
  "date": "2021-04-28",
  "amount_lost_usd": "50000000",
  "blockchain": "binance_smart_chain",
  "language": "solidity",
  "vulnerability_type": "arithmetic_error",
  "vulnerability_subtype": "",
  "severity": "",
  "difficulty_tier": 0,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Uranium Finance forked Uniswap V2 and changed the swap fee from 0.3% to 0.16%, updating the fee calculation denominator from 1000 to 10000. However, they failed to update the constant product (K) validation check to use the same scale. The adjusted balances used scale 10000, but the K check compared against reserves * 1000^2, creating a 100x mismatch that allowed K to inflate after each swap.",
  "vulnerable_contract": "SwapPair",
  "vulnerable_function": "swap",
  "vulnerable_lines": [
    100
  ],
  "attack_scenario": "1) Attacker deposited tokens into Uranium WBNB/BUSD pool. 2) Executed swap with amount0In. 3) K validation: left side (balance * 10000) vs right side (reserve * 1000^2) created 100x discrepancy. 4) Check passed even though K actually increased 100x. 5) Swapped back in opposite direction with even more inflated K. 6) Each swap cycle further inflated the constant product. 7) After 5-10 iterations, attacker drained $50M by extracting more tokens than deposited. Pool became completely imbalanced.",
  "root_cause": "When changing the fee from 0.3% to 0.16%, developers updated the fee calculation to use denominator 10000 instead of 1000. However, the constant product invariant check still used the old 1000 scale (reserve0 * reserve1 * 1000^2) instead of the new scale (reserve0 * reserve1 * 10000^2). This created a 100x mismatch allowing K to inflate after swaps.",
  "fix_description": "",
  "source_reference": "",
  "external_references": [],
  "tags": [
    "amm",
    "constant_product",
    "uniswap_fork",
    "precision_mismatch",
    "decoy",
    "calculation_error",
    "false_prophet",
    "bsc"
  ],
  "variant_type": "false_prophet",
  "variant_parent_id": "tc_019",
  "notes": "",
  "contract_file": "contracts/fp_tc_019.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "false_prophet",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_019.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_019.json",
    "script": "manual",
    "changes": [
      "Added misleading security comments and NatSpec documentation",
      "Added fake audit claims and security attestations",
      "Added reassuring comments near vulnerable code sections",
      "Preserved original vulnerability without modification"
    ],
    "false_prophet_enhancements": [
      {
        "location": "CONTRACT HEADER",
        "description": "Professional DEX documentation:",
        "comments_added": [
          "Added: \"Uniswap V2 style AMM pair with optimized fee structure\"",
          "Added: \"Audited by Certik (Q1 2021) - All findings resolved\"",
          "Added: \"Implements constant product market maker with 0.16% fee\"",
          "Added: \"Gas-optimized reserve management with uint112 packing\""
        ]
      }
    ],
    "manual_enhancements_count": 5,
    "contract_type": "Uniswap V2 Fork / AMM Pair",
    "vulnerability_preserved": true,
    "misleading_comments_added": true,
    "created_date": "2025-12-30T21:14:14.933434",
    "sanitized": true,
    "sanitization_date": "2026-01-02T00:36:43.864329",
    "contract_renames": {
      "UraniumPair": "SwapPair"
    }
  }
}
