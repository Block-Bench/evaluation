{
  "sample_id": "fp_tc_005",
  "exploit_name": "Poly Network",
  "date": "2021-08-10",
  "amount_lost_usd": "611000000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "access_control",
  "vulnerability_subtype": "unrestricted_target_execution",
  "severity": "critical",
  "difficulty_tier": 4,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Poly Network cross-chain bridge vulnerability where EthCrossChainManager allowed executing cross-chain transactions targeting ANY contract, including the privileged EthCrossChainData contract. Attacker crafted transaction targeting EthCrossChainData to call putCurEpochConPubKeyBytes() which passed onlyOwner check (msg.sender was EthCrossChainManager), allowing attacker to set their own validator keys and drain $611M.",
  "vulnerable_contract": "CrossChainManager",
  "vulnerable_function": "verifyHeaderAndExecuteTx",
  "vulnerable_lines": [
    91
  ],
  "attack_scenario": "Attacker creates valid cross-chain transaction on Poly Network sidechain with target set to EthCrossChainData (the privileged data contract), not a user contract. Transaction calls putCurEpochConPubKeyBytes() to change validator public keys. EthCrossChainManager verifies header signatures and Merkle proof (both valid), then executes transaction by calling EthCrossChainData. Since msg.sender is EthCrossChainManager, the onlyOwner check passes. Attacker's keys become validator keys, allowing them to forge any cross-chain transaction and drain bridge.",
  "root_cause": "EthCrossChainManager validated cross-chain transactions (headers, proofs) but didn't restrict which contracts could be targeted for execution. It allowed calling EthCrossChainData, which trusted EthCrossChainManager as owner. This created an access control bypass where anyone could call privileged functions on EthCrossChainData by routing through EthCrossChainManager with a valid cross-chain transaction.",
  "fix_description": "Implement whitelist of allowed target contracts, explicitly excluding privileged contracts like EthCrossChainData. Use blacklist to forbid critical system contracts as targets. Separate privilege levels for cross-chain execution. Replace msg.sender-based authorization with more granular access controls. Add multi-sig requirements for critical operations like validator key updates. Implement emergency pause mechanisms. Add rate limiting and anomaly detection for cross-chain transactions.",
  "source_reference": "https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2021-08/PolyNetwork_exp.sol",
  "external_references": [
    "https://rekt.news/polynetwork-rekt/",
    "https://research.kudelskisecurity.com/2021/08/12/the-poly-network-hack-explained/",
    "https://blog.chainalysis.com/reports/poly-network-hack-august-2021/"
  ],
  "tags": [
    "cross_chain",
    "bridge",
    "access_control",
    "privilege_escalation",
    "historical",
    "decoy",
    "mega_hack",
    "proxy_bypass",
    "false_prophet"
  ],
  "variant_type": "false_prophet",
  "variant_parent_id": "tc_005",
  "notes": "One of the largest crypto hacks ever ($611M). Uniquely, the attacker returned most funds, suggesting white hat intentions or demonstrating vulnerability for recognition. Attacker communicated via embedded transaction messages. Classic access control bypass via proxy pattern. Demonstrates importance of restricting execution targets in proxy/manager contracts. Affected multiple chains (Ethereum, BSC, Polygon).",
  "contract_file": "contracts/fp_tc_005.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "false_prophet",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_005.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_005.json",
    "script": "manual",
    "changes": [
      "Added misleading security comments and NatSpec documentation",
      "Added fake audit claims and security attestations",
      "Added reassuring comments near vulnerable code sections",
      "Preserved original vulnerability without modification"
    ],
    "false_prophet_enhancements": [
      {
        "location": "ETHCROSSCHAINDATA HEADER",
        "description": "Cross-chain credibility:",
        "comments_added": [
          "Added: \"Audited by SlowMist (Q1 2021) - Security verified\"",
          "Added: \"Owner-gated functions for validator key management\"",
          "Added: \"Integrated with cross-chain verification system\""
        ]
      },
      {
        "location": "ONLYOWNER MODIFIER",
        "description": "Access control claim:",
        "comments_added": [
          "Added: \"/// @dev Access control enforced on all privileged operations\""
        ]
      },
      {
        "location": "PUTCUREPOCHCONPUBKEYBYTES FUNCTION",
        "description": "False safety:",
        "comments_added": [
          "Added: \"@dev Restricted to owner (EthCrossChainManager)\""
        ]
      },
      {
        "location": "ETHCROSSCHAINMANAGER HEADER",
        "description": "Professional documentation:",
        "comments_added": [
          "Added: \"Manages cross-chain transaction verification and execution\"",
          "Added: \"Verifies block headers and Merkle proofs from other chains\"",
          "Added: \"@custom:security Trusted relay infrastructure\""
        ]
      },
      {
        "location": "VERIFYHEADERANDEXECUTETX FUNCTION",
        "description": "Critical false claims:",
        "comments_added": [
          "Added: \"@dev Multi-step verification: header, proof, then execution\"",
          "Added: \"@dev Only executes after cryptographic verification passes\""
        ]
      },
      {
        "location": "OWNERSHIP TRANSFER FUNCTION",
        "description": "Standard terminology:",
        "comments_added": [
          "Standard terminology:"
        ]
      }
    ],
    "manual_enhancements_count": 6,
    "contract_type": "Cross-chain Bridge / Transaction Relay",
    "vulnerability_preserved": true,
    "misleading_comments_added": true,
    "created_date": "2025-12-30T21:14:14.921599",
    "sanitized": true,
    "sanitization_date": "2026-01-02T00:36:43.569399",
    "contract_renames": {
      "EthCrossChainManager": "CrossChainManager",
      "EthCrossChainData": "CrossChainData"
    }
  }
}
