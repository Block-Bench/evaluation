{
  "sample_id": "fp_tc_002",
  "exploit_name": "Beanstalk",
  "date": "2022-04-17",
  "amount_lost_usd": "182000000",
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "governance_attack",
  "vulnerability_subtype": "flash_loan_voting",
  "severity": "critical",
  "difficulty_tier": 4,
  "is_vulnerable": true,
  "temporal_category": "pre_cutoff",
  "description": "Beanstalk governance attack using flash loans to gain voting power and execute malicious proposal. Attacker borrowed $1B via flash loan, deposited into Silo to gain majority voting power, proposed and immediately executed a malicious governance action to drain the protocol, then repaid the flash loan.",
  "vulnerable_contract": "Governance",
  "vulnerable_function": "emergencyCommit",
  "vulnerable_lines": [
    55,
    56,
    101,
    102,
    107
  ],
  "attack_scenario": "Attacker takes massive flash loan from Aave ($1B in stablecoins), swaps for Curve 3pool LP tokens, deposits into Beanstalk Silo gaining >66% voting power, creates malicious governance proposal to transfer all funds, votes with flash-loan-funded power, immediately executes via emergencyCommit(), drains protocol, repays flash loan with profit.",
  "root_cause": "Governance system allowed instant voting power from deposits with no time-weighting or holding period. The emergencyCommit() function enabled immediate execution of proposals that reached 66% approval, with no time delay for community review. This combination made flash loan governance attacks trivial to execute.",
  "fix_description": "Implement time-weighted voting where voting power increases with duration of deposit. Add minimum holding period before deposits grant voting rights. Implement mandatory time delay (timelock) between proposal creation and execution. Remove or heavily restrict emergencyCommit() function. Use snapshot-based voting to prevent same-block deposit and vote. Add multi-sig or guardian oversight for emergency functions.",
  "source_reference": "https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2022-04/Beanstalk_exp.sol",
  "external_references": [
    "https://etherscan.io/tx/0x68cdec0ac76454c3b0f7af0b8a3895db00adf6daaf3b50a99716858c4fa54c6f",
    "https://rekt.news/beanstalk-rekt/"
  ],
  "tags": [
    "governance",
    "historical",
    "voting",
    "flash_loan",
    "decoy",
    "mega_hack",
    "false_prophet",
    "defi",
    "timelock"
  ],
  "variant_type": "false_prophet",
  "variant_parent_id": "tc_002",
  "notes": "One of the most significant governance attacks in DeFi history. Demonstrated that on-chain governance without time-weighting or timelocks is vulnerable to flash loan manipulation. The attacker used $1B in borrowed capital to completely control the protocol for a single block.",
  "contract_file": "contracts/fp_tc_002.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "transformation": {
    "type": "false_prophet",
    "strategy": "decoy",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/contracts/ms_tc_002.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/minimalsanitized/metadata/ms_tc_002.json",
    "script": "manual",
    "changes": [
      "Added misleading security comments and NatSpec documentation",
      "Added fake audit claims and security attestations",
      "Added reassuring comments near vulnerable code sections",
      "Preserved original vulnerability without modification"
    ],
    "false_prophet_enhancements": [
      {
        "location": "CONTRACT HEADER",
        "description": "Protocol-specific with credibility markers:",
        "comments_added": [
          "Added: \"Implements battle-tested voting mechanism from Compound Governor pattern\"",
          "Added: \"Emergency execution pathway for time-sensitive protocol actions\""
        ]
      },
      {
        "location": "VOTING POWER MAPPING",
        "description": "Added governance terminology:",
        "comments_added": [
          "Added: \"/// @dev Voting power derived from staked LP positions\""
        ]
      },
      {
        "location": "EMERGENCY THRESHOLD",
        "description": "Added reassuring comment:",
        "comments_added": [
          "Added: \"/// @dev Conservative threshold ensures broad consensus required\""
        ]
      },
      {
        "location": "DEPOSIT FUNCTION",
        "description": "Added professional NatSpec:",
        "comments_added": [
          "Added: \"@dev Voting power scales linearly with deposit size\"",
          "Added: \"@dev Position tracked for reward distribution\""
        ]
      },
      {
        "location": "PROPOSE FUNCTION",
        "description": "Added governance documentation:",
        "comments_added": [
          "Added: \"@dev Only accounts with existing voting power can propose\"",
          "Added: \"@dev Proposal enters voting period upon creation\""
        ]
      },
      {
        "location": "EMERGENCYCOMMIT FUNCTION",
        "description": "Critical false claims:",
        "comments_added": [
          "Added: \"@dev Requires supermajority (66%) consensus\"",
          "Added: \"@dev Reserved for time-critical protocol maintenance\""
        ]
      }
    ],
    "manual_enhancements_count": 6,
    "contract_type": "Governance / Voting System",
    "vulnerability_preserved": true,
    "misleading_comments_added": true,
    "created_date": "2025-12-30T21:14:14.915211",
    "sanitized": true,
    "sanitization_date": "2026-01-02T00:36:43.394888",
    "contract_renames": {
      "BeanstalkGovernance": "Governance"
    }
  }
}