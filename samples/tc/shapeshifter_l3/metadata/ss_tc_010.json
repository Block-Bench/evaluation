{
  "id": "rari_capital_2022",
  "exploit_name": "Rari Capital Fuse",
  "date": "2022-05-08",
  "blockchain": "ethereum",
  "amount_stolen_usd": "80000000",
  "amount_stolen_crypto": "Various",
  "vulnerability_type": "reentrancy",
  "attack_type": "cross_function_reentrancy",
  "difficulty": 4,
  "impact": "critical",
  "description": "Cross-function reentrancy attack. The borrow function sent ETH before final health check, allowing attacker to call exitMarket during callback and bypass collateral requirements.",
  "root_cause": "Cross-function reentrancy. Borrow sent ETH (triggering callback) before final validation. Attacker called exitMarket during callback, modifying shared state (inMarket) and bypassing health checks.",
  "attack_scenario": "Attacker deposited collateral and entered market, called borrow to get ETH. During ETH transfer callback, attacker called exitMarket to remove collateral requirement. Final health check used stale state, allowing over-borrowing.",
  "vulnerable_contract": "LendingHub",
  "vulnerable_function": "_0x0353ce",
  "vulnerable_lines": [
    43,
    45,
    49
  ],
  "fix_description": "Use global ReentrancyGuard on all functions that share state. Perform all validations after external calls. Prevent exitMarket when positions are open. Consider mutex locks for cross-function protection.",
  "tags": [
    "reentrancy",
    "cross-function",
    "oracle-manipulation",
    "health-check"
  ],
  "references": [
    "https://www.blocksecteam.com/blog/2022/05/rari-capital-fuse-pool-hack/",
    "https://twitter.com/FeiProtocol/status/1520847142650499072"
  ],
  "historical_significance": "Demonstrated sophisticated cross-function reentrancy. Shows that per-function reentrancy guards aren't sufficient when multiple functions share state.",
  "compiler_version": "0.8.0",
  "is_pre_cutoff": true,
  "cutoff_date": "2024-01-01",
  "contract_file": "contracts/ss_tc_010.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "sample_id": "ss_tc_010",
  "variant_type": "shapeshifter_l3",
  "variant_parent_id": "nc_tc_010",
  "transformation": {
    "type": "shapeshifter",
    "level": "l3",
    "includes": [
      "L1 formatting",
      "L2 hex identifiers",
      "L3 control flow"
    ],
    "identifier_style": "hex",
    "intensity": "medium",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/contracts/nc_tc_010.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/nocomments/metadata/nc_tc_010.json",
    "script": "strategies/shapeshifter/shapeshifter_tc.py",
    "changes": [
      "Stripped existing line markers",
      "Renamed 22 identifiers using hex style",
      "Applied L1 tight formatting (removed blank lines, K&R braces)",
      "Added fresh sequential line markers"
    ],
    "rename_map": {
      "depositAndEnterMarket": "_0x390062",
      "getAccountLiquidity": "_0x0cce35",
      "additionalBorrow": "_0x8cd0a4",
      "collateralValue": "_0x7d6277",
      "totalBorrowed": "_0x7248ad",
      "totalDeposits": "_0x477183",
      "_comptroller": "_0x347a3f",
      "enterMarkets": "_0x2c833f",
      "comptroller": "_0xd80623",
      "exitMarket": "_0x1045d1",
      "totalDebt": "_0x0f4194",
      "isHealthy": "_0x2ff8d2",
      "borrowed": "_0x6ff151",
      "inMarket": "_0x771f54",
      "deposits": "_0x0d961f",
      "withdraw": "_0x65ce0c",
      "account": "_0xd6cb4d",
      "cTokens": "_0x70dd97",
      "success": "_0xe5feba",
      "amount": "_0x8e6f03",
      "borrow": "_0x0353ce",
      "cToken": "_0x51bedd"
    },
    "coverage_percent": 68.75,
    "identifiers_transformed": 22,
    "created_date": "2025-12-31T19:59:41.160379"
  },
  "sanitized_from": "ms_tc_010",
  "is_vulnerable": true
}